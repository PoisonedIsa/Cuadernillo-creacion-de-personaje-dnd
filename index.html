<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D&D Booklet (16 Páginas) - Edición Deluxe (Custom Pattern)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- FUENTES ACTUALIZADAS -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Roboto+Condensed:wght@300;400;700&family=MedievalSharp&family=Patrick+Hand&family=UnifrakturMaguntia&family=Pinyon+Script&display=swap" rel="stylesheet">
    <style>
        :root { 
            /* VARIABLES DE TEMA */
            --border-thick: 3px double #2c2c2c; 
            --border-thin: 1px solid #444; 
            --border-radius: 4px;
            --bg-paper: #fdfbf7; 
            --font-title: 'Cinzel', serif;
            --font-body: 'Roboto Condensed', sans-serif;
            --border-stat-circle: 1.5px solid black;
            
            /* TAMAÑOS BASE */
            --s-title: 22px; 
            --s-stat: 18px;  
            --s-body: 12.5px; 
            --s-label: 10px; 
        }
        
        /* --- ESTILOS DE PORTADA (COVER STYLES) --- */
        
        .cover-container {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100%; width: 100%; position: relative; padding: 20px; box-sizing: border-box;
            z-index: 10; overflow: hidden;
        }

        /* Marcos Decorativos (Corners) */
        .corner-decoration { position: absolute; width: 80px; height: 80px; z-index: 5; pointer-events: none; transition: all 0.3s ease; }
        .corner-tl { top: 0px; left: 0px; transform: scale(1); }
        .corner-tr { top: 0px; right: 0px; transform: scaleX(-1); }
        .corner-br { bottom: 0px; right: 0px; transform: scale(-1); }
        .corner-bl { bottom: 0px; left: 0px; transform: scaleY(-1); }
        
        /* Marco Principal */
        .main-frame {
            position: absolute; inset: 20px; pointer-events: none; z-index: 0;
            border: 2px solid #1a1a1a; transition: all 0.3s ease;
        }

        /* Cuadro de Arte Central - Transparente */
        .art-frame-wrapper {
            position: relative; width: 180px; height: 180px; margin: 20px auto;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.3s ease; z-index: 20; 
            background: rgba(255,255,255,0.7); /* Transparencia */
            box-sizing: border-box;
            backdrop-filter: blur(2px);
        }
        .art-input-trigger {
            width: 100%; height: 100%; position: absolute; inset: 0; 
            cursor: pointer; z-index: 30; opacity: 0;
        }
        .art-preview {
            width: 100%; height: 100%; object-fit: cover; 
            display: none; z-index: 25; pointer-events: none;
        }
        .art-placeholder-text {
            text-align: center; color: #666; font-size: 10px; text-transform: uppercase; letter-spacing: 2px;
            pointer-events: none; font-weight: bold;
        }
        
        /* ESTILO GLOBAL DEL TÍTULO DE PORTADA (Unificado a Cinzel) */
        .cover-title { 
            font-family: 'Cinzel', serif !important; 
            font-weight: 900 !important; 
            letter-spacing: 4px; 
            text-transform: uppercase;
            font-size: 36px !important;
            border-bottom: 2px solid black; 
            padding-bottom: 5px;
        }
        .subtitle-text {
            letter-spacing: 3px; 
            font-family: 'Cinzel', serif; 
            font-size: 10px;
            font-weight: 700;
        }

        /* --- CLASES ESPECÍFICAS POR MODO (PORTADA) --- */

        /* 1. MARCIAL (Hierro / Rígido / Geométrico) - Diseño Original Conservado */
        body.mode-martial .main-frame {
            border: 3px solid #000;
            outline: 2px solid #000; outline-offset: -8px;
            inset: 25px;
        }
        body.mode-martial .art-frame-wrapper {
            border: 4px solid #1a1a1a;
            outline: 2px solid #1a1a1a; outline-offset: -6px; /* Doble borde interno */
            box-shadow: 5px 5px 0px rgba(0,0,0,0.8);
            border-radius: 0px;
            width: 170px; height: 210px;
        }

        /* 2. ARCANO (Geometría Mística / Limpio / Legible) - Rediseñado */
        body.mode-magic .main-frame {
            border: 2px solid #000;
            outline: 1px solid #000; outline-offset: 4px; /* Doble línea externa */
            inset: 30px;
            border-radius: 2px;
        }
        body.mode-magic .art-frame-wrapper {
            border: 3px solid #000;
            outline: 1px solid #000; outline-offset: 4px; /* Doble borde externo */
            border-radius: 50%;
            width: 180px; height: 180px;
            box-shadow: 0 0 0 8px rgba(255,255,255,0.4); /* Espacio limpio alrededor */
        }

        /* 3. EXPERTO (Precisión / Diamantes / Afilado) - Rediseñado */
        body.mode-expert .main-frame {
            border: 2px solid #000;
            inset: 25px;
        }
        body.mode-expert .art-frame-wrapper {
            border: 3px solid #000;
            outline: 1px solid #000; outline-offset: -6px; /* Doble borde interno */
            transform: rotate(45deg);
            width: 150px; height: 150px;
            box-shadow: 4px 4px 0px rgba(0,0,0,0.1);
        }
        body.mode-expert .art-preview { transform: rotate(-45deg) scale(1.45); } 
        body.mode-expert .art-placeholder-text { transform: rotate(-45deg); }

        /* 4. SACRO (Catedral / Arcos) - Font arreglada */
        body.mode-sacred .main-frame {
            border: 2px solid #000;
            inset: 25px;
        }
        body.mode-sacred .main-frame::before {
            content:''; position: absolute; top: 0; bottom: 0; left: 6px; right: 6px;
            border-left: 1px solid #000; border-right: 1px solid #000;
        }
        body.mode-sacred .art-frame-wrapper {
            border: 3px solid #000;
            outline: 2px solid #000; outline-offset: -6px; /* Doble borde interno */
            border-radius: 200px 200px 0 0; /* Ventana Ojival */
            width: 160px; height: 230px;
            border-bottom-width: 3px;
        }
        
        /* TEMA GÓTICO */
        body.theme-gothic {
            --border-thick: 2px solid #1a1a1a; 
            --border-thin: 1px solid #000;
            --border-radius: 0px; 
            --bg-paper: #f0eee6; 
            --font-title: 'MedievalSharp', cursive; 
            --font-body: 'MedievalSharp', cursive;
            --border-stat-circle: 2px solid #000;
        }
        body.theme-gothic .font-bold, body.theme-gothic strong, body.theme-gothic .text-label, body.theme-gothic .text-title { font-weight: 400 !important; }
        body.theme-gothic .text-title { letter-spacing: 1px; } 
        body.theme-gothic .text-label { font-size: 10px !important; letter-spacing: 0.5px; } 

        /* TEMA DOODLE */
        body.theme-doodle {
            --border-thick: 2px dashed #444; 
            --border-thin: 1px dashed #888;
            --border-radius: 15px; 
            --bg-paper: #fff; 
            --font-title: 'Patrick Hand', cursive; 
            --font-body: 'Patrick Hand', cursive;
            --border-stat-circle: 2px dashed #444;
        }
        body.theme-doodle .text-title { font-weight: 400 !important; letter-spacing: 1px; font-size: 24px !important; }
        body.theme-doodle input, body.theme-doodle textarea { border-bottom: 1.5px dashed #ccc !important; } 
        body.theme-doodle .box-border { box-shadow: none; border-width: 2px; } 
        body.theme-doodle .stat-box { border: 2px dashed #000; } 

        body { 
            font-family: var(--font-body); 
            background-color: #222; 
            margin: 0; 
            padding: 0 0 40px 0; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            gap: 30px; 
        }
        
        /* CLASES DE TEXTO */
        .text-title { font-size: var(--s-title) !important; line-height: 1.1; font-weight: 700; font-family: var(--font-title); text-transform: uppercase; color: #1a1a1a; }
        .text-stat { font-size: var(--s-stat) !important; font-weight: 700; line-height: 1; font-family: var(--font-title); }
        .text-body { font-size: var(--s-body) !important; line-height: 1.3; font-weight: 400; font-family: var(--font-body); }
        .text-label { font-size: var(--s-label) !important; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; line-height: 1.1; color: #444; font-family: var(--font-body); }
        .text-condensed { letter-spacing: -0.5px; } /* Nueva clase para textos apretados */

        input[type="text"], textarea { 
            background: transparent; border: none; border-bottom: 0.5px dotted #666; 
            font-family: var(--font-body); width: 100%; padding: 0 2px; margin: 0; 
            display: block; height: 100%; line-height: 1.3; box-sizing: border-box;
            font-size: var(--s-body);
            transition: border-color 0.3s, background 0.3s;
        }
        input:focus, textarea:focus { outline: none; border-bottom: 1px solid #000; background: rgba(0,0,0,0.05); }
        .no-line { border-bottom: none !important; }

        /* HOJAS */
        .sheet-wrapper { position: relative; width: 297mm; display: flex; flex-direction: column; gap: 5px; }
        .sheet-landscape { 
            background-color: transparent; /* Changed from var(--bg-paper) to handle per-page color */
            width: 297mm; height: 210mm; padding: 0; display: flex; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.5); position: relative; box-sizing: border-box; 
            overflow: hidden; page-break-after: always; border-radius: 2px;
        }
        .page-a5 { 
            width: 148.5mm; height: 210mm; padding: 6mm 8mm 14mm 8mm; 
            box-sizing: border-box; display: flex; flex-direction: column; position: relative; 
            background-color: var(--bg-paper); /* Default Background */
            z-index: 0;
            transition: background-color 0.3s ease;
        }

        .pattern-layer {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            z-index: 0; pointer-events: none; opacity: 0.12; 
            background-repeat: repeat; background-position: center; background-size: 150px; 
            mix-blend-mode: multiply; /* Better blending with colors */
        }
        .page-a5 > *:not(.pattern-layer):not(.page-num):not(.cover-element):not(.page-settings) { position: relative; z-index: 1; }

        /* --- CONTROLES DE PÁGINA (COLOR Y TRAMA) --- */
        .page-settings {
            position: absolute; top: 0; right: 0; z-index: 100; padding: 4px;
            opacity: 0; transition: opacity 0.2s; 
            display: flex; gap: 4px; align-items: flex-start;
        }
        .page-a5:hover .page-settings { opacity: 1; }
        
        .setting-btn {
            width: 24px; height: 24px; 
            background: white; border: 1px solid #999; border-radius: 4px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; overflow: hidden; position: relative;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
            transition: transform 0.1s, background-color 0.2s;
        }
        .setting-btn:hover { background: #f0f0f0; transform: scale(1.05); }
        .setting-btn input { 
            position: absolute; opacity: 0; width: 100%; height: 100%; top:0; left:0; cursor: pointer; 
        }
        .setting-btn svg { width: 14px; height: 14px; stroke: #333; }

        /* --- DIVISOR CON GUÍAS DE ENCUADERNACIÓN --- */
        .divider { 
            position: absolute; 
            left: 50%; 
            top: 0; 
            bottom: 0; 
            width: 1px; /* Ancho de la guía */
            transform: translateX(-50%); 
            z-index: 10;
            
            /* TÉCNICA DE GUÍAS DE COSTURA */
            /* Crea una linea negra de 1.5px de alto, luego transparente */
            background-image: linear-gradient(to bottom, #000 1.5px, transparent 1.5px);
            /* Se repite cada 10mm (1cm) de alto */
            background-size: 100% 10mm; 
            /* Empieza desplazado 10mm (1cm) desde arriba */
            background-position: 0 10mm;
            
            background-repeat: repeat-y;
            border: none; /* Quitamos el borde dashed antiguo */
        }

        /* --- CLASES DE CONTENEDORES (MODIFICADAS PARA TRANSPARENCIA) --- */
        .box-border { 
            border: var(--border-thick); 
            border-radius: var(--border-radius); 
            background: rgba(255, 255, 255, 0.5); /* TRANSPARENTE */
            box-shadow: 2px 2px 0px rgba(0,0,0,0.05); 
            backdrop-filter: blur(1px);
        }
        .stat-box { 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            border: 2px solid #000; border-radius: 8px; position: relative; 
            background: rgba(255, 255, 255, 0.7); /* TRANSPARENTE */
            z-index: 5; box-shadow: 1px 1px 3px rgba(0,0,0,0.1); 
        }
        .stat-box span { font-weight: 900; font-size: var(--s-body); font-family: var(--font-title); margin-top: 2px; } 
        body.theme-gothic .stat-box { border-radius: 2px; border: 2px solid #000; }
        .stat-score-bubble { 
            border: var(--border-stat-circle); border-radius: 50%; 
            background: rgba(255, 255, 255, 0.9); /* Ligeramente más opaco para leer el número */
            position: absolute; bottom: -8px; display: flex; align-items: center; justify-content: center; z-index: 10; width: 24px; height: 20px; font-weight: bold;
        }
        /* Shield SVG actualizado para usar fill transparente */
        .shield-shape { 
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="rgba(255,255,255,0.7)" stroke="black" stroke-width="1.5"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>') no-repeat center center; 
            background-size: contain; filter: drop-shadow(1px 1px 0px rgba(0,0,0,0.1)); 
        }
        
        .icon-svg-bg { position: relative; display: flex; align-items: center; justify-content: center; }
        .icon-svg-bg svg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        .icon-svg-bg input { position: relative; z-index: 10; }

        /* SKILLS MEJORADO */
        .skill-row { font-size: var(--s-body); display: flex; align-items: center; gap: 2px; line-height: 1.25; white-space: nowrap; font-weight: 400; margin-bottom: 0px; letter-spacing: -0.3px; }
        .skill-mod-input { width: 18px !important; border-bottom: 1px solid #000 !important; text-align: center; margin-right: 2px; font-size: var(--s-body); height: 14px; font-weight: 400; padding: 0; display: inline-block; vertical-align: middle; }
        .checkbox-round { width: 10px; height: 10px; border: 1.5px solid #333; border-radius: 50%; appearance: none; cursor: pointer; flex-shrink: 0; margin-right: 1px; background: white; }
        .checkbox-round:checked { background-color: #333; border-color: #000; }
        
        .hex-check { width: 12px; height: 12px; border: 1px solid #000; transform: rotate(45deg); display: inline-block; margin: 2px; cursor: pointer; background: white; }
        .hex-check:checked { background: #000; }
        .comp-check { appearance: none; width: 10px; height: 10px; border: 1.5px solid black; border-radius: 50%; margin: 0; cursor: pointer; background: white; display: inline-block; vertical-align: middle; }
        .comp-check:checked { background: black; }
        
        .icon-checkbox { appearance: none; position: absolute; inset: 0; width: 100%; height: 100%; z-index: 20; cursor: pointer; }
        .icon-checkbox:checked + svg { fill: #000; }
        .icon-checkbox:checked + svg path { stroke: #000; }

        .rules-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 4px; }
        .rules-box { 
            background: rgba(255, 255, 255, 0.7); /* TRANSPARENTE */
            border: 2px solid #000; border-radius: var(--border-radius); padding: 4px; font-size: var(--s-body); display: flex; flex-direction: column; box-shadow: 2px 2px 0 rgba(0,0,0,0.05); 
        }
        .rules-title { font-weight: 800; text-transform: uppercase; border-bottom: 2px solid #000; margin-bottom: 3px; display: block; font-size: var(--s-label); color: black; font-family: var(--font-title); letter-spacing: 1px; }
        .ref-row { display: flex; justify-content: space-between; border-bottom: 1px dotted #ccc; margin-bottom: 2px; padding-bottom: 1px; align-items: baseline; }
        .ref-row:last-child { border-bottom: none; }
        .ref-key { font-weight: 700; font-size: var(--s-label); text-transform: uppercase; width: 30%; flex-shrink: 0; color: #222; }
        .ref-val { font-size: 9.5px; text-align: right; color: #444; width: 70%; font-weight: 400; text-transform: none; line-height: 1.1; letter-spacing: -0.2px; }

        .lined-bg { background-image: linear-gradient(#ccc 1px, transparent 1px); background-size: 100% 20px; background-position: 0 19px; line-height: 20px !important; }
        .dot-grid { background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iMSIgY3k9IjEiIHI9IjEiIGZpbGw9IiNjY2MiLz48L3N2Zz4='); background-repeat: repeat; }
        .page-num { position: absolute; bottom: 5mm; width: 100%; left: 0; text-align: center; font-size: var(--s-body); color: #000; font-weight: 700; font-family: var(--font-title); z-index: 50; }
        .force-border { 
            border: 1px solid #000 !important; 
            background: rgba(255, 255, 255, 0.5); /* TRANSPARENTE */
        }

        .spell-header-box { 
            border: 3px double black; border-radius: var(--border-radius); display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; 
            background: rgba(255, 255, 255, 0.6); /* TRANSPARENTE */
        }
        .spell-card { position: relative; border-bottom: 1.5px dashed #888; padding-bottom: 6px; margin-bottom: 6px; display: flex; gap: 6px; }
        .spell-level-diamond { 
            width: 28px; height: 28px; border: 2px solid black; transform: rotate(45deg); display: flex; items-center; justify-content: center; 
            background: rgba(255, 255, 255, 0.7); /* TRANSPARENTE */
            margin: 4px auto 0 auto; box-shadow: 2px 2px 0px rgba(0,0,0,0.1); 
        }
        .spell-level-input { width: 100%; height: 100%; transform: rotate(-45deg); text-align: center; font-weight: 900; font-size: var(--s-stat); border: none !important; background: transparent; padding: 0; }
        .desc-4-lines { height: 80px; width: 100%; }

        .martial-content, .magic-content, .expert-content, .sacred-content { display: none !important; }
        body.mode-martial .martial-content, body.mode-magic .magic-content, body.mode-expert .expert-content, body.mode-sacred .sacred-content { display: block !important; }
        body.mode-martial .martial-content.flex, body.mode-magic .magic-content.flex, body.mode-expert .expert-content.flex, body.mode-sacred .sacred-content.flex { display: flex !important; }

        /* Vectores SVG de Portada (Control de visibilidad) */
        .svg-diamond { display: none; }
        .svg-skull { display: none; }
        .svg-star { display: none; }
        .svg-cross { display: none; }

        body.mode-expert .svg-diamond { display: block; }
        body.mode-martial .svg-skull { display: block; }
        body.mode-magic .svg-star { display: block; }
        body.mode-sacred .svg-cross { display: block; }

        @media print { 
            body { background: white; margin: 0; padding: 0; display: block; } 
            .sheet-wrapper { margin: 0; page-break-after: always; }
            .sheet-landscape { margin: 0; box-shadow: none; border: none; } 
            .no-print, .sheet-controls, .page-settings { display: none !important; } 
            .top-bar { display: none !important; }
            .page-a5 { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            * { border-color: #000 !important; }
        }
    </style>
</head>
<body class="mode-martial">

    <!-- BARRA SUPERIOR -->
    <div class="top-bar no-print sticky top-0 z-50 w-full bg-[#222] border-b border-gray-600 shadow-xl py-3 flex justify-center items-center backdrop-blur-md bg-opacity-95">
         <div class="w-[297mm] flex gap-2 items-center px-4 md:px-0 overflow-x-auto">
             <div class="flex items-center gap-2 bg-gray-800 p-1 rounded border border-gray-600 whitespace-nowrap">
                 <span class="text-white text-xs font-bold px-1">CLASE:</span>
                 <select id="classSelector" onchange="changeClassMode(this.value)" class="bg-gray-700 text-white text-sm rounded border border-gray-500 px-2 py-1 cursor-pointer hover:bg-gray-600 focus:outline-none">
                     <option value="martial" selected>Marciales</option>
                     <option value="magic">Arcanos</option>
                     <option value="expert">Expertos</option>
                     <option value="sacred">Sacros</option>
                 </select>
             </div>
             <div class="flex items-center gap-2 bg-gray-800 p-1 rounded border border-gray-600 ml-2 whitespace-nowrap">
                 <span class="text-white text-xs font-bold px-1">ESTILO:</span>
                 <select id="themeSelector" onchange="changeTheme(this.value)" class="bg-gray-700 text-white text-sm rounded border border-gray-500 px-2 py-1 cursor-pointer hover:bg-gray-600 focus:outline-none">
                     <option value="classic">Clásico</option>
                     <option value="gothic">Gótico</option>
                     <option value="doodle">Doodle</option>
                 </select>
             </div>
             
             <!-- NUEVO CONTROL DE COLOR GLOBAL -->
             <div class="flex items-center gap-2 bg-gray-800 p-1 rounded border border-gray-600 ml-2 whitespace-nowrap">
                 <span class="text-white text-xs font-bold px-1">PAPEL:</span>
                 <input type="color" id="globalColorPicker" value="#fdfbf7" onchange="applyGlobalColor(this.value)" class="w-8 h-6 p-0 border-0 rounded cursor-pointer">
                 <button onclick="applyGlobalColor('#fdfbf7'); document.getElementById('globalColorPicker').value='#fdfbf7';" class="text-xs text-gray-400 hover:text-white underline">Reset</button>
             </div>

             <div class="flex-grow"></div>
             <input type="file" id="patternInput" accept="image/*" class="hidden" onchange="applyPattern(this)">
             <button onclick="document.getElementById('patternInput').click()" class="bg-purple-700 text-white px-3 py-2 rounded shadow font-bold hover:bg-purple-800 text-xs transition-colors">TRAMA GLOBAL</button>
             <input type="file" id="bgInput" accept="image/*" class="hidden" onchange="applyBackground(this)">
             <button onclick="document.getElementById('bgInput').click()" class="bg-blue-600 text-white px-3 py-2 rounded shadow font-bold hover:bg-blue-700 text-xs transition-colors">SUBIR FONDO</button>
             <button onclick="downloadAllSheets()" class="bg-green-600 text-white px-3 py-2 rounded shadow font-bold hover:bg-green-700 text-xs transition-colors">DESCARGAR</button>
             <button onclick="window.print()" class="bg-gray-800 text-white px-3 py-2 rounded shadow font-bold hover:bg-gray-700 text-xs transition-colors">IMPRIMIR</button>
         </div>
    </div>

    <!-- CUBIERTA EXTERIOR -->
    <div class="sheet-wrapper">
        <div class="sheet-controls no-print text-white mb-1 flex justify-between">
            <span>Cubierta Exterior (P16 Contraportada - P1 Portada)</span> 
            <button onclick="downloadSheet('sheetCover')" class="hover:text-blue-300 underline cursor-pointer text-xs ml-2">Descargar</button>
        </div>
        <div id="sheetCover" class="sheet-landscape">
            <div class="divider"></div>
            <!-- P16: CONTRA PORTADA -->
            <div class="page-a5">
                <div class="page-settings">
                     <div class="setting-btn" title="Color de Fondo">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 11l-8-8-8 9.9 8.1 8.1c1.3 1.3 3.3 1.3 4.6 0l2.7-2.7c1.3-1.3 1.3-3.3 0-4.6z"></path><path d="M22 22l-4-4"></path></svg>
                        <input type="color" onchange="this.closest('.page-a5').style.backgroundColor = this.value">
                     </div>
                     <div class="setting-btn" title="Trama/Patrón Individual">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="3" y1="15" x2="21" y2="15"></line><line x1="9" y1="3" x2="9" y2="21"></line><line x1="15" y1="3" x2="15" y2="21"></line></svg>
                        <input type="file" accept="image/*" onchange="applyLocalPattern(this)">
                     </div>
                </div>
                <h2 class="text-title text-center mb-4 border-b-2 border-black pb-2">REGISTRO DE MISIONES</h2>
                <div class="flex-grow flex flex-col gap-2">
                    <div class="box-border p-2 bg-white/60 flex flex-col h-1/3">
                        <span class="text-label border-b border-black mb-1">OBJETIVO PRINCIPAL</span>
                        <textarea class="flex-grow lined-bg border-none resize-none text-body bg-transparent"></textarea>
                    </div>
                    <div class="box-border p-2 bg-white/60 flex flex-col flex-grow">
                        <span class="text-label border-b border-black mb-1">MISIONES SECUNDARIAS / TAREAS</span>
                        <div class="flex flex-col gap-1 mt-1">
                             <script>
                                for(let i=0; i<8; i++){
                                    document.write(`
                                    <div class="flex gap-2 items-center border-b border-dotted border-gray-400 pb-1">
                                        <input type="checkbox" class="w-4 h-4 border-2 border-black rounded-sm cursor-pointer flex-shrink-0">
                                        <input type="text" class="no-line text-body font-bold">
                                    </div>
                                    `);
                                }
                             </script>
                        </div>
                        <textarea class="flex-grow lined-bg border-none resize-none text-body bg-transparent mt-2"></textarea>
                    </div>
                </div>
                <div class="mt-4 border-t-2 border-black pt-2 text-center text-label">
                    <span>REGISTRO DE MUERTES / ESTADO</span>
                    <div class="flex justify-center gap-4 mt-2">
                        <div class="flex flex-col items-center"><div class="w-8 h-8 border border-black rounded-full"></div><span>KO #1</span></div>
                        <div class="flex flex-col items-center"><div class="w-8 h-8 border border-black rounded-full"></div><span>KO #2</span></div>
                        <div class="flex flex-col items-center"><div class="w-8 h-8 border border-black rounded-full"></div><span>KO #3</span></div>
                    </div>
                </div>
            </div>
            
            <!-- P1: PORTADA PRINCIPAL (NUEVA ESTRUCTURA INTEGRADA) -->
            <div class="page-a5 cover-container">
                <div class="page-settings">
                     <div class="setting-btn" title="Color de Fondo">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 11l-8-8-8 9.9 8.1 8.1c1.3 1.3 3.3 1.3 4.6 0l2.7-2.7c1.3-1.3 1.3-3.3 0-4.6z"></path><path d="M22 22l-4-4"></path></svg>
                        <input type="color" onchange="this.closest('.page-a5').style.backgroundColor = this.value">
                     </div>
                     <div class="setting-btn" title="Trama/Patrón Individual">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="3" y1="15" x2="21" y2="15"></line><line x1="9" y1="3" x2="9" y2="21"></line><line x1="15" y1="3" x2="15" y2="21"></line></svg>
                        <input type="file" accept="image/*" onchange="applyLocalPattern(this)">
                     </div>
                </div>
                <!-- Marco Decorativo Principal -->
                <div class="main-frame cover-element"></div>

                <!-- Esquinas Decorativas (Cambian por clase) -->
                <div class="corner-decoration corner-tl cover-element">
                    <!-- DIAMANTES (Experto) -->
                    <svg class="svg-diamond w-full h-full" viewBox="0 0 100 100" fill="none" stroke="black" stroke-width="2">
                        <path d="M0,0 L25,0 L25,5 L5,5 L5,25 L0,25 Z" fill="black" stroke="none"/>
                        <path d="M10,10 L30,10 L10,30 Z" fill="none" stroke="black" stroke-width="1"/>
                        <rect x="5" y="35" width="2" height="20" fill="black"/>
                        <rect x="35" y="5" width="20" height="2" fill="black"/>
                        <path d="M40,40 L50,50 L40,60 L30,50 Z" fill="black"/>
                    </svg>

                    <!-- HIERRO FORJADO (Marcial) -->
                    <svg class="svg-skull w-full h-full" viewBox="0 0 100 100" fill="black">
                        <path d="M0,0 L100,0 L100,20 L30,20 L20,30 L20,100 L0,100 Z" />
                        <circle cx="25" cy="25" r="4" fill="white"/>
                        <rect x="0" y="35" width="10" height="20" fill="black"/>
                        <rect x="35" y="0" width="20" height="10" fill="black"/>
                    </svg>

                    <!-- MÍSTICO GEOMÉTRICO (Arcano) -->
                    <svg class="svg-star w-full h-full" viewBox="0 0 100 100" fill="none" stroke="black" stroke-width="2">
                         <path d="M0,0 L50,0 A50,50 0 0 0 0,50 Z" fill="black" stroke="none"/>
                         <path d="M15,15 L25,15 L20,5 L15,15" fill="white" stroke="none"/> 
                         <circle cx="0" cy="0" r="70" stroke="black" stroke-width="1.5" fill="none" stroke-dasharray="4 2"/>
                         <circle cx="0" cy="0" r="80" stroke="black" stroke-width="1" fill="none"/>
                    </svg>

                    <!-- ORNAMENTO GÓTICO (Sacro) -->
                    <svg class="svg-cross w-full h-full" viewBox="0 0 100 100" fill="black">
                        <path d="M0,0 L40,0 L40,10 L10,10 L10,40 L0,40 Z"/>
                        <path d="M10,10 L30,30 L15,30 L10,45 L10,10 Z" fill="none" stroke="black" stroke-width="1"/>
                        <rect x="40" y="0" width="10" height="30" />
                        <rect x="0" y="40" width="30" height="10" />
                        <circle cx="5" cy="5" r="2" fill="white"/>
                    </svg>
                </div>

                <div class="corner-decoration corner-tr cover-element">
                    <svg class="svg-diamond w-full h-full" viewBox="0 0 100 100" fill="none" stroke="black" stroke-width="2"><path d="M0,0 L25,0 L25,5 L5,5 L5,25 L0,25 Z" fill="black" stroke="none"/><path d="M10,10 L30,10 L10,30 Z" fill="none" stroke="black" stroke-width="1"/><rect x="5" y="35" width="2" height="20" fill="black"/><rect x="35" y="5" width="20" height="2" fill="black"/><path d="M40,40 L50,50 L40,60 L30,50 Z" fill="black"/></svg>
                    <svg class="svg-skull w-full h-full" viewBox="0 0 100 100" fill="black"><path d="M0,0 L100,0 L100,20 L30,20 L20,30 L20,100 L0,100 Z" /><circle cx="25" cy="25" r="4" fill="white"/><rect x="0" y="35" width="10" height="20" fill="black"/><rect x="35" y="0" width="20" height="10" fill="black"/></svg>
                    <svg class="svg-star w-full h-full" viewBox="0 0 100 100" fill="none" stroke="black" stroke-width="2"><path d="M0,0 L50,0 A50,50 0 0 0 0,50 Z" fill="black" stroke="none"/><path d="M15,15 L25,15 L20,5 L15,15" fill="white" stroke="none"/> <circle cx="0" cy="0" r="70" stroke="black" stroke-width="1.5" fill="none" stroke-dasharray="4 2"/><circle cx="0" cy="0" r="80" stroke="black" stroke-width="1" fill="none"/></svg>
                    <svg class="svg-cross w-full h-full" viewBox="0 0 100 100" fill="black"><path d="M0,0 L40,0 L40,10 L10,10 L10,40 L0,40 Z"/><path d="M10,10 L30,30 L15,30 L10,45 L10,10 Z" fill="none" stroke="black" stroke-width="1"/><rect x="40" y="0" width="10" height="30" /><rect x="0" y="40" width="30" height="10" /><circle cx="5" cy="5" r="2" fill="white"/></svg>
                </div>
                <div class="corner-decoration corner-br cover-element">
                    <svg class="svg-diamond w-full h-full" viewBox="0 0 100 100" fill="none" stroke="black" stroke-width="2"><path d="M0,0 L25,0 L25,5 L5,5 L5,25 L0,25 Z" fill="black" stroke="none"/><path d="M10,10 L30,10 L10,30 Z" fill="none" stroke="black" stroke-width="1"/><rect x="5" y="35" width="2" height="20" fill="black"/><rect x="35" y="5" width="20" height="2" fill="black"/><path d="M40,40 L50,50 L40,60 L30,50 Z" fill="black"/></svg>
                    <svg class="svg-skull w-full h-full" viewBox="0 0 100 100" fill="black"><path d="M0,0 L100,0 L100,20 L30,20 L20,30 L20,100 L0,100 Z" /><circle cx="25" cy="25" r="4" fill="white"/><rect x="0" y="35" width="10" height="20" fill="black"/><rect x="35" y="0" width="20" height="10" fill="black"/></svg>
                    <svg class="svg-star w-full h-full" viewBox="0 0 100 100" fill="none" stroke="black" stroke-width="2"><path d="M0,0 L50,0 A50,50 0 0 0 0,50 Z" fill="black" stroke="none"/><path d="M15,15 L25,15 L20,5 L15,15" fill="white" stroke="none"/> <circle cx="0" cy="0" r="70" stroke="black" stroke-width="1.5" fill="none" stroke-dasharray="4 2"/><circle cx="0" cy="0" r="80" stroke="black" stroke-width="1" fill="none"/></svg>
                    <svg class="svg-cross w-full h-full" viewBox="0 0 100 100" fill="black"><path d="M0,0 L40,0 L40,10 L10,10 L10,40 L0,40 Z"/><path d="M10,10 L30,30 L15,30 L10,45 L10,10 Z" fill="none" stroke="black" stroke-width="1"/><rect x="40" y="0" width="10" height="30" /><rect x="0" y="40" width="30" height="10" /><circle cx="5" cy="5" r="2" fill="white"/></svg>
                </div>
                <div class="corner-decoration corner-bl cover-element">
                    <svg class="svg-diamond w-full h-full" viewBox="0 0 100 100" fill="none" stroke="black" stroke-width="2"><path d="M0,0 L25,0 L25,5 L5,5 L5,25 L0,25 Z" fill="black" stroke="none"/><path d="M10,10 L30,10 L10,30 Z" fill="none" stroke="black" stroke-width="1"/><rect x="5" y="35" width="2" height="20" fill="black"/><rect x="35" y="5" width="20" height="2" fill="black"/><path d="M40,40 L50,50 L40,60 L30,50 Z" fill="black"/></svg>
                    <svg class="svg-skull w-full h-full" viewBox="0 0 100 100" fill="black"><path d="M0,0 L100,0 L100,20 L30,20 L20,30 L20,100 L0,100 Z" /><circle cx="25" cy="25" r="4" fill="white"/><rect x="0" y="35" width="10" height="20" fill="black"/><rect x="35" y="0" width="20" height="10" fill="black"/></svg>
                    <svg class="svg-star w-full h-full" viewBox="0 0 100 100" fill="none" stroke="black" stroke-width="2"><path d="M0,0 L50,0 A50,50 0 0 0 0,50 Z" fill="black" stroke="none"/><path d="M15,15 L25,15 L20,5 L15,15" fill="white" stroke="none"/> <circle cx="0" cy="0" r="70" stroke="black" stroke-width="1.5" fill="none" stroke-dasharray="4 2"/><circle cx="0" cy="0" r="80" stroke="black" stroke-width="1" fill="none"/></svg>
                    <svg class="svg-cross w-full h-full" viewBox="0 0 100 100" fill="black"><path d="M0,0 L40,0 L40,10 L10,10 L10,40 L0,40 Z"/><path d="M10,10 L30,30 L15,30 L10,45 L10,10 Z" fill="none" stroke="black" stroke-width="1"/><rect x="40" y="0" width="10" height="30" /><rect x="0" y="40" width="30" height="10" /><circle cx="5" cy="5" r="2" fill="white"/></svg>
                </div>

                <!-- CONTENIDO -->
                <div class="z-20 w-full flex flex-col items-center justify-between h-full py-8">
                    <!-- TÍTULO -->
                    <div class="text-center w-full px-8 relative">
                        <h1 class="cover-title text-4xl mb-1 uppercase text-black drop-shadow-sm">DIARIO DE<br>PERSONAJE</h1>
                        <span class="subtitle-text text-label text-gray-600 block text-[9px] uppercase mt-1">EDICIÓN DE CAMPAÑA 5E</span>
                    </div>

                    <!-- CUADRO DE ARTE CENTRAL -->
                    <div class="art-frame-wrapper cover-element">
                         <div class="art-placeholder-text">ARTE<br>CLICK AQUÍ</div>
                         <input type="file" id="coverArtInput" class="art-input-trigger" accept="image/*" onchange="loadCoverArt(this)">
                         <img id="coverArtImg" class="art-preview">
                    </div>

                    <!-- DATOS DEL JUGADOR -->
                    <div class="w-full text-center mb-6 px-10">
                        <div class="mb-4">
                            <label class="subtitle-text text-[9px] uppercase tracking-widest text-gray-500 block mb-0.5 font-bold">NOMBRE DEL PERSONAJE</label>
                            <input type="text" class="text-center font-bold text-2xl border-b-2 border-black w-full bg-transparent font-['Cinzel'] no-line">
                        </div>
                        <div class="flex gap-4 justify-center">
                            <div class="w-1/2">
                                <label class="subtitle-text text-[8px] uppercase tracking-widest text-gray-500 block">JUGADOR</label>
                                <input type="text" class="text-center text-sm border-b border-gray-400 w-full bg-transparent no-line">
                            </div>
                            <div class="w-1/2">
                                <label class="subtitle-text text-[8px] uppercase tracking-widest text-gray-500 block">CAMPAÑA</label>
                                <input type="text" class="text-center text-sm border-b border-gray-400 w-full bg-transparent no-line">
                            </div>
                        </div>
                    </div>

                    <!-- FOOTER DECORATIVO -->
                    <div class="text-center">
                         <svg width="40" height="20" viewBox="0 0 40 20" class="mx-auto mb-1 opacity-60">
                             <path d="M0 10 Q10 0 20 10 Q30 20 40 10" stroke="black" fill="none" stroke-width="1.5"/>
                         </svg>
                         <span class="subtitle-text text-[8px] uppercase tracking-[2px] text-gray-400 font-['Cinzel']">Designed by Poisoned Isa</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- CUBIERTA INTERIOR -->
    <div class="sheet-wrapper">
        <div class="sheet-controls no-print text-white mb-1"><span>Cubierta Interior (P2 Grupo - P15 Log)</span> <button onclick="downloadSheet('sheetInner')" class="hover:text-blue-300 underline cursor-pointer text-xs ml-2">Descargar</button></div>
        <div id="sheetInner" class="sheet-landscape">
            <div class="divider"></div>
            <!-- P2 -->
            <div class="page-a5">
                <div class="page-settings">
                     <div class="setting-btn" title="Color de Fondo">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 11l-8-8-8 9.9 8.1 8.1c1.3 1.3 3.3 1.3 4.6 0l2.7-2.7c1.3-1.3 1.3-3.3 0-4.6z"></path><path d="M22 22l-4-4"></path></svg>
                        <input type="color" onchange="this.closest('.page-a5').style.backgroundColor = this.value">
                     </div>
                     <div class="setting-btn" title="Trama/Patrón Individual">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="3" y1="15" x2="21" y2="15"></line><line x1="9" y1="3" x2="9" y2="21"></line><line x1="15" y1="3" x2="15" y2="21"></line></svg>
                        <input type="file" accept="image/*" onchange="applyLocalPattern(this)">
                     </div>
                </div>
                <h2 class="text-title text-center border-b-2 border-black mb-4">EL GRUPO DE AVENTURA</h2>
                <div class="flex flex-col gap-3 flex-grow h-full py-2">
                    <script>
                        for(let i=1; i<=5; i++){
                            document.write(`
                            <div class="box-border p-2 bg-white/60 flex gap-2 h-1/5 shadow-sm border border-gray-400 items-start">
                                <div class="w-8 flex flex-col items-center justify-start pt-1 flex-shrink-0">
                                    <div class="w-6 h-6 rounded-full border border-black bg-gray-100 flex items-center justify-center font-bold text-gray-400 text-xs">${i}</div>
                                </div>
                                <div class="flex-grow flex flex-col justify-between h-full w-full">
                                    <div class="flex gap-2 w-full">
                                        <div class="w-2/3"><label class="text-label text-[10px] text-gray-500 block">NOMBRE PERSONAJE</label><input type="text" class="font-bold w-full border-b border-gray-300 h-5"></div>
                                        <div class="w-1/3"><label class="text-label text-[10px] text-gray-500 block text-right">CLASE / ROL</label><input type="text" class="text-right w-full border-b border-gray-300 h-5 text-xs"></div>
                                    </div>
                                    <div class="flex gap-2 w-full flex-grow items-end pb-1">
                                        <div class="w-1/3"><label class="text-label text-[10px] text-gray-500 block">JUGADOR</label><input type="text" class="w-full border-b border-gray-300 h-4 text-xs text-gray-600"></div>
                                        <div class="w-2/3 relative h-full flex flex-col justify-end"><label class="text-label text-[10px] text-gray-500 block bg-white/50 pr-1 w-full text-left">NOTAS</label><textarea class="w-full h-8 resize-none border-b border-gray-300 text-body bg-transparent p-0 align-bottom"></textarea></div>
                                    </div>
                                </div>
                            </div>
                            `);
                        }
                    </script>
                </div>
            </div>
            <!-- P15 -->
            <div class="page-a5">
                <div class="page-settings">
                     <div class="setting-btn" title="Color de Fondo">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 11l-8-8-8 9.9 8.1 8.1c1.3 1.3 3.3 1.3 4.6 0l2.7-2.7c1.3-1.3 1.3-3.3 0-4.6z"></path><path d="M22 22l-4-4"></path></svg>
                        <input type="color" onchange="this.closest('.page-a5').style.backgroundColor = this.value">
                     </div>
                     <div class="setting-btn" title="Trama/Patrón Individual">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="3" y1="15" x2="21" y2="15"></line><line x1="9" y1="3" x2="9" y2="21"></line><line x1="15" y1="3" x2="15" y2="21"></line></svg>
                        <input type="file" accept="image/*" onchange="applyLocalPattern(this)">
                     </div>
                </div>
                <h2 class="text-title text-center border-b-2 border-black mb-4">HISTORIAL DE NIVELES</h2>
                <div class="box-border p-2 bg-white/60 h-full flex flex-col relative">
                    <div class="grid grid-cols-[30px_1fr_100px] gap-2 border-b-2 border-black mb-2 pb-1 text-label font-bold text-center">
                        <div>NV</div><div class="text-left">RASGO OBTENIDO / MEJORA</div><div>FECHA</div>
                    </div>
                    <div class="flex flex-col gap-1 overflow-hidden z-10">
                        <script>
                            for(let i=1; i<=20; i++){
                                document.write(`
                                <div class="grid grid-cols-[30px_1fr_100px] gap-2 items-center border-b border-gray-200 py-0.5">
                                    <div class="font-bold text-center text-stat">${i}</div>
                                    <input type="text" class="no-line text-body">
                                    <div class="flex items-end justify-between gap-1 h-full px-1">
                                        <input type="text" class="w-5 text-center border-b border-gray-400 p-0 text-[11px]"><span class="text-gray-400 text-[10px]">/</span>
                                        <input type="text" class="w-5 text-center border-b border-gray-400 p-0 text-[11px]"><span class="text-gray-400 text-[10px]">/</span>
                                        <input type="text" class="w-8 text-center border-b border-gray-400 p-0 text-[11px]">
                                    </div>
                                </div>
                                `);
                            }
                        </script>
                    </div>
                    <!-- CONTENEDOR DE IMAGEN DEL SÍMBOLO -->
                    <div class="flex-grow"></div>
                    <div class="flex justify-center items-center p-2 h-32 opacity-80">
                        <img id="levelHistorySymbolImg" class="h-full object-contain hidden" alt="Símbolo del Personaje">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- HOJA 1 (Mapas/Stats) -->
    <div class="sheet-wrapper">
        <div class="sheet-controls no-print text-white mb-1"><span>Hoja Núcleo 1 (Mapas y Stats)</span> <button onclick="downloadSheet('sheet1')" class="hover:text-blue-300 underline cursor-pointer text-xs ml-2">Descargar</button></div>
        <div id="sheet1" class="sheet-landscape">
            <div class="divider"></div>
            <!-- PÁGINA MAPA -->
            <div class="page-a5">
                <div class="page-settings">
                     <div class="setting-btn" title="Color de Fondo">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 11l-8-8-8 9.9 8.1 8.1c1.3 1.3 3.3 1.3 4.6 0l2.7-2.7c1.3-1.3 1.3-3.3 0-4.6z"></path><path d="M22 22l-4-4"></path></svg>
                        <input type="color" onchange="this.closest('.page-a5').style.backgroundColor = this.value">
                     </div>
                     <div class="setting-btn" title="Trama/Patrón Individual">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="3" y1="15" x2="21" y2="15"></line><line x1="9" y1="3" x2="9" y2="21"></line><line x1="15" y1="3" x2="15" y2="21"></line></svg>
                        <input type="file" accept="image/*" onchange="applyLocalPattern(this)">
                     </div>
                </div>
                <h2 class="text-title border-b-2 border-black mb-3 text-center">Mapa / Bocetos</h2>
                <div class="h-full w-full border-2 border-gray-400 dot-grid rounded bg-white/60 box-border"></div>
                <div class="page-num">14</div>
            </div>
            <!-- PÁGINA STATS -->
            <div class="page-a5">
                <div class="page-settings">
                     <div class="setting-btn" title="Color de Fondo">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 11l-8-8-8 9.9 8.1 8.1c1.3 1.3 3.3 1.3 4.6 0l2.7-2.7c1.3-1.3 1.3-3.3 0-4.6z"></path><path d="M22 22l-4-4"></path></svg>
                        <input type="color" onchange="this.closest('.page-a5').style.backgroundColor = this.value">
                     </div>
                     <div class="setting-btn" title="Trama/Patrón Individual">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="3" y1="15" x2="21" y2="15"></line><line x1="9" y1="3" x2="9" y2="21"></line><line x1="15" y1="3" x2="15" y2="21"></line></svg>
                        <input type="file" accept="image/*" onchange="applyLocalPattern(this)">
                     </div>
                </div>
                <div class="grid grid-cols-12 gap-2 mb-2 border-b border-black pb-1 items-end">
                    <div class="col-span-10"><input type="text" class="text-title h-7 border-b-2 border-black w-full" value=""><label class="text-label">Nombre (Resumen)</label></div>
                    <div class="col-span-2 flex flex-col items-center"><div class="border-2 border-black w-9 h-9 flex items-center justify-center rounded bg-white/60 shadow-sm"><input type="text" class="text-center text-stat w-full h-full p-0 no-line"></div><label class="text-label mt-0.5">NIVEL</label></div>
                    <div class="col-span-4"><input type="text" class="h-4 w-full border-b border-gray-400"><label class="text-label">Clase</label></div>
                    <div class="col-span-4"><input type="text" class="h-4 w-full border-b border-gray-400"><label class="text-label">Subclase</label></div>
                    <div class="col-span-4"><input type="text" class="h-4 w-full border-b border-gray-400"><label class="text-label">Raza</label></div>
                    <div class="col-span-4"><input type="text" class="h-4 w-full border-b border-gray-400"><label class="text-label">Trasfondo</label></div>
                    <div class="col-span-4"><input type="text" class="h-4 w-full border-b border-gray-400"><label class="text-label">Alineación</label></div>
                    <div class="col-span-4"><input type="text" class="h-4 w-full border-b border-gray-400"><label class="text-label">XP</label></div>
                </div>
                <div class="flex gap-2 h-full">
                    <div class="w-[58%] flex flex-col gap-1">
                        <div class="bg-white/60 p-1.5 rounded box-border flex-grow flex flex-col border-2 border-gray-800">
                            <!-- BONO DE COMPETENCIA -->
                            <div class="flex justify-between items-center border-b border-gray-400 pb-1 mb-1">
                                <span class="text-label">BONO COMPETENCIA</span>
                                <div class="border border-black rounded-full w-7 h-7 flex items-center justify-center bg-white/60">
                                    <input type="text" class="text-center text-stat w-full h-full p-0 bg-transparent no-line">
                                </div>
                            </div>
                            <div class="flex-grow flex flex-col justify-around gap-0.5">
                                <!-- FUERZA -->
                                <div class="flex items-center gap-1 border-b border-gray-200 pb-0.5">
                                    <div class="stat-box w-12 h-12 flex-shrink-0"><span>FUE</span><input type="text" class="text-center text-stat p-0 h-5 no-line"><div class="stat-score-bubble"><input type="text" class="text-center text-label w-full p-0 bg-transparent no-line"></div></div>
                                    <div class="flex-1 pl-1">
                                        <div class="flex items-center justify-between border-b border-gray-300 mb-0.5 pb-0.5"><span class="text-body font-bold text-[11px]">Salvación</span><div class="flex items-center"><input type="checkbox" class="checkbox-round mr-1"><input type="text" class="skill-mod-input no-line"></div></div>
                                        <div class="skill-row"><input type="checkbox" class="checkbox-round"><input type="text" class="skill-mod-input no-line"> Atletismo</div>
                                    </div>
                                </div>
                                <!-- DESTREZA -->
                                <div class="flex items-start gap-1 border-b border-gray-200 pb-0.5">
                                    <div class="stat-box w-12 h-12 flex-shrink-0"><span>DES</span><input type="text" class="text-center text-stat p-0 h-5 no-line"><div class="stat-score-bubble"><input type="text" class="text-center text-label w-full p-0 bg-transparent no-line"></div></div>
                                    <div class="flex-1 pl-1">
                                        <div class="flex items-center justify-between border-b border-gray-300 mb-0.5 pb-0.5"><span class="text-body font-bold text-[11px]">Salvación</span><div class="flex items-center"><input type="checkbox" class="checkbox-round mr-1"><input type="text" class="skill-mod-input no-line"></div></div>
                                        <div class="grid grid-cols-2 gap-x-1">
                                            <div class="skill-row"><input type="checkbox" class="checkbox-round"><input type="text" class="skill-mod-input no-line"> Acrobacia</div>
                                            <div class="skill-row"><input type="checkbox" class="checkbox-round"><input type="text" class="skill-mod-input no-line"> Sigilo</div>
                                            <div class="skill-row col-span-2"><input type="checkbox" class="checkbox-round"><input type="text" class="skill-mod-input no-line"> J. Manos</div>
                                        </div>
                                    </div>
                                </div>
                                <!-- CONSTITUCION -->
                                <div class="flex items-center gap-1 border-b border-gray-200 pb-0.5">
                                    <div class="stat-box w-12 h-12 flex-shrink-0"><span>CON</span><input type="text" class="text-center text-stat p-0 h-5 no-line"><div class="stat-score-bubble"><input type="text" class="text-center text-label w-full p-0 bg-transparent no-line"></div></div>
                                    <div class="flex-1 pl-1">
                                        <div class="flex items-center justify-between border-b border-gray-300 mb-0.5 pb-0.5"><span class="text-body font-bold text-[11px]">Salvación</span><div class="flex items-center"><input type="checkbox" class="checkbox-round mr-1"><input type="text" class="skill-mod-input no-line"></div></div>
                                    </div>
                                </div>
                                <!-- INTELIGENCIA -->
                                <div class="flex items-start gap-1 border-b border-gray-200 pb-0.5">
                                    <div class="stat-box w-12 h-12 flex-shrink-0"><span>INT</span><input type="text" class="text-center text-stat p-0 h-5 no-line"><div class="stat-score-bubble"><input type="text" class="text-center text-label w-full p-0 bg-transparent no-line"></div></div>
                                    <div class="flex-1 pl-1">
                                        <div class="flex items-center justify-between border-b border-gray-300 mb-0.5 pb-0.5"><span class="text-body font-bold text-[11px]">Salvación</span><div class="flex items-center"><input type="checkbox" class="checkbox-round mr-1"><input type="text" class="skill-mod-input no-line"></div></div>
                                        <div class="grid grid-cols-2 gap-x-1">
                                            <div class="skill-row"><input type="checkbox" class="checkbox-round"><input type="text" class="skill-mod-input no-line"> Arcano</div>
                                            <div class="skill-row"><input type="checkbox" class="checkbox-round"><input type="text" class="skill-mod-input no-line"> Historia</div>
                                            <div class="skill-row"><input type="checkbox" class="checkbox-round"><input type="text" class="skill-mod-input no-line"> Invest.</div>
                                            <div class="skill-row"><input type="checkbox" class="checkbox-round"><input type="text" class="skill-mod-input no-line"> Natur.</div>
                                            <div class="skill-row col-span-2"><input type="checkbox" class="checkbox-round"><input type="text" class="skill-mod-input no-line"> Religión</div>
                                        </div>
                                    </div>
                                </div>
                                <!-- SABIDURIA -->
                                <div class="flex items-start gap-1 border-b border-gray-200 pb-0.5">
                                    <div class="stat-box w-12 h-12 flex-shrink-0"><span>SAB</span><input type="text" class="text-center text-stat p-0 h-5 no-line"><div class="stat-score-bubble"><input type="text" class="text-center text-label w-full p-0 bg-transparent no-line"></div></div>
                                    <div class="flex-1 pl-1">
                                        <div class="flex items-center justify-between border-b border-gray-300 mb-0.5 pb-0.5"><span class="text-body font-bold text-[11px]">Salvación</span><div class="flex items-center"><input type="checkbox" class="checkbox-round mr-1"><input type="text" class="skill-mod-input no-line"></div></div>
                                        <div class="grid grid-cols-2 gap-x-1">
                                            <div class="skill-row"><input type="checkbox" class="checkbox-round"><input type="text" class="skill-mod-input no-line"> Animales</div>
                                            <div class="skill-row"><input type="checkbox" class="checkbox-round"><input type="text" class="skill-mod-input no-line"> Medic.</div>
                                            <div class="skill-row"><input type="checkbox" class="checkbox-round"><input type="text" class="skill-mod-input no-line"> Percep.</div>
                                            <div class="skill-row"><input type="checkbox" class="checkbox-round"><input type="text" class="skill-mod-input no-line"> Perspic.</div>
                                            <div class="skill-row col-span-2"><input type="checkbox" class="checkbox-round"><input type="text" class="skill-mod-input no-line"> Superviv.</div>
                                        </div>
                                    </div>
                                </div>
                                <!-- CARISMA -->
                                <div class="flex items-start gap-1">
                                    <div class="stat-box w-12 h-12 flex-shrink-0"><span>CAR</span><input type="text" class="text-center text-stat p-0 h-5 no-line"><div class="stat-score-bubble"><input type="text" class="text-center w-full p-0 bg-transparent no-line"></div></div>
                                    <div class="flex-1 pl-1">
                                        <div class="flex items-center justify-between border-b border-gray-300 mb-0.5 pb-0.5"><span class="text-body font-bold text-[11px]">Salvación</span><div class="flex items-center"><input type="checkbox" class="checkbox-round mr-1"><input type="text" class="skill-mod-input no-line"></div></div>
                                        <div class="grid grid-cols-2 gap-x-1">
                                            <div class="skill-row"><input type="checkbox" class="checkbox-round"><input type="text" class="skill-mod-input no-line"> Engaño</div>
                                            <div class="skill-row"><input type="checkbox" class="checkbox-round"><input type="text" class="skill-mod-input no-line"> Intim.</div>
                                            <div class="skill-row"><input type="checkbox" class="checkbox-round"><input type="text" class="skill-mod-input no-line"> Interp.</div>
                                            <div class="skill-row"><input type="checkbox" class="checkbox-round"><input type="text" class="skill-mod-input no-line"> Persua.</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="flex justify-between gap-2 mt-1">
                                <div class="border border-black p-0.5 text-center flex-[2] bg-white/60 rounded">
                                    <span class="text-label block">PERCEP. PASIVA</span>
                                    <input type="text" class="text-center text-stat p-0 no-line bg-transparent">
                                </div>
                                <div class="border border-black p-0.5 text-center flex-1 bg-white/60 rounded flex flex-col items-center justify-center relative cursor-pointer group">
                                    <span class="text-label block absolute top-0.5 left-0 w-full text-center">INSPIR.</span>
                                    <div class="relative w-10 h-10 mt-3 flex items-center justify-center">
                                         <input type="checkbox" class="icon-checkbox">
                                         <svg class="absolute inset-0 w-full h-full pointer-events-none transition-colors" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="1.5">
                                             <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                                         </svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="w-[42%] flex flex-col gap-2">
                        <div class="flex items-center justify-between bg-white/60 rounded p-1.5 border border-gray-300 shadow-sm gap-1">
                            <div class="text-center w-12 flex flex-col items-center"><div class="shield-shape w-10 h-12 flex items-center justify-center"><input type="text" class="text-center w-8 text-stat bg-transparent no-line font-bold"></div><span class="text-label block mt-0.5">CA</span></div>
                            <div class="text-center border box-border w-12 h-12 flex flex-col items-center justify-center bg-white/50 rounded">
                                <input type="text" class="text-center text-stat w-full p-0 no-line">
                                <span class="text-label block mt-[-2px]">INIC.</span>
                            </div>
                            <div class="text-center border box-border w-12 h-12 flex flex-col items-center justify-center bg-white/50 rounded">
                                <input type="text" class="text-center text-stat w-full p-0 no-line">
                                <span class="text-label block mt-[-2px]">VEL.</span>
                            </div>
                        </div>

                        <!-- HP -->
                        <div class="box-border p-1 bg-white/60 relative min-h-[80px] flex items-center justify-center overflow-hidden">
                            <svg viewBox="0 0 24 24" fill="none" stroke="#e5e7eb" stroke-width="1" class="absolute inset-0 w-full h-full pointer-events-none text-gray-100 opacity-20">
                                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                            </svg>
                            <div class="relative z-10 w-full flex flex-col items-center">
                                <div class="flex w-full justify-between px-2 text-[10px] text-gray-500 font-bold uppercase mb-1 border-b border-gray-200">
                                    <span>Máx</span><span>Temp</span>
                                </div>
                                <div class="flex w-full justify-between px-2 mb-1">
                                    <input type="text" class="w-12 text-center text-body border-b border-gray-300">
                                    <input type="text" class="w-12 text-center text-body border-b border-gray-300">
                                </div>
                                <textarea class="text-center text-4xl font-black w-full bg-transparent resize-none h-12 no-line leading-none p-0 overflow-hidden placeholder-gray-200" placeholder="HP"></textarea>
                                <span class="text-label font-bold mt-1">PUNTOS DE GOLPE</span>
                            </div>
                        </div>

                        <div class="box-border p-1.5 bg-white/60"><div class="flex justify-between items-center border-b border-black mb-1"><span class="text-label">DADOS GOLPE</span><span class="text-label text-gray-800">(1d____)</span></div><div class="flex gap-2"><div class="w-1/2 text-center border-r border-gray-300"><label class="text-label block text-gray-500">TOTAL</label><input type="text" class="text-center text-stat w-full p-0 no-line bg-transparent"></div><div class="w-1/2 text-center"><label class="text-label block text-gray-500">RESTANTES</label><input type="text" class="text-center text-stat w-full p-0 no-line bg-transparent"></div></div></div>
                        
                        <!-- SALVACIONES MUERTE -->
                        <div class="box-border p-2 bg-white/60">
                            <label class="text-label block text-center mb-1 border-b border-black pb-1">SALVACIÓN DE MUERTE</label>
                            <div class="flex justify-between items-center mb-2 px-1">
                                <span class="text-label font-bold">Éxito</span>
                                <div class="flex gap-2">
                                    <div class="relative w-4 h-4"><input type="checkbox" class="icon-checkbox"><svg class="absolute inset-0 w-full h-full pointer-events-none" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg></div>
                                    <div class="relative w-4 h-4"><input type="checkbox" class="icon-checkbox"><svg class="absolute inset-0 w-full h-full pointer-events-none" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg></div>
                                    <div class="relative w-4 h-4"><input type="checkbox" class="icon-checkbox"><svg class="absolute inset-0 w-full h-full pointer-events-none" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg></div>
                                </div>
                            </div>
                            <div class="flex justify-between items-center px-1">
                                <span class="text-label font-bold">Fallo</span>
                                <div class="flex gap-2">
                                    <div class="relative w-4 h-4"><input type="checkbox" class="icon-checkbox"><svg class="absolute inset-0 w-full h-full pointer-events-none" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2"><path d="M12 2c-4 0-8 3-8 8 0 4 3 7 7 7 .5 0 1 0 1.5.5L14 20h-4l1.5-2.5c.5-.5 1-.5 1.5-.5 4 0 7-3 7-7 0-5-4-8-8-8z"></path><circle cx="9" cy="9" r="1" fill="#000"></circle><circle cx="15" cy="9" r="1" fill="#000"></circle></svg></div>
                                    <div class="relative w-4 h-4"><input type="checkbox" class="icon-checkbox"><svg class="absolute inset-0 w-full h-full pointer-events-none" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2"><path d="M12 2c-4 0-8 3-8 8 0 4 3 7 7 7 .5 0 1 0 1.5.5L14 20h-4l1.5-2.5c.5-.5 1-.5 1.5-.5 4 0 7-3 7-7 0-5-4-8-8-8z"></path><circle cx="9" cy="9" r="1" fill="#000"></circle><circle cx="15" cy="9" r="1" fill="#000"></circle></svg></div>
                                    <div class="relative w-4 h-4"><input type="checkbox" class="icon-checkbox"><svg class="absolute inset-0 w-full h-full pointer-events-none" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2"><path d="M12 2c-4 0-8 3-8 8 0 4 3 7 7 7 .5 0 1 0 1.5.5L14 20h-4l1.5-2.5c.5-.5 1-.5 1.5-.5 4 0 7-3 7-7 0-5-4-8-8-8z"></path><circle cx="9" cy="9" r="1" fill="#000"></circle><circle cx="15" cy="9" r="1" fill="#000"></circle></svg></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="box-border p-1.5 bg-white/60 h-24">
                            <span class="text-label block border-b border-black mb-1">IDIOMAS Y COMPETENCIAS</span>
                            <textarea class="w-full h-full border-none resize-none bg-transparent text-body p-0"></textarea>
                        </div>
                        
                        <div class="box-border p-1.5 bg-white/60 flex-grow flex flex-col items-center justify-center relative group cursor-pointer border-dashed border-2 border-gray-400 hover:border-black transition-colors" onclick="document.getElementById('p1SymbolInput').click()">
                            <input type="file" id="p1SymbolInput" class="hidden" accept="image/*" onchange="previewSymbol(this)">
                            <img id="p1SymbolImg" class="absolute inset-0 w-full h-full object-contain p-1 hidden">
                            <span class="text-label text-gray-400 group-hover:text-black text-center pointer-events-none">CLICK PARA SUBIR<br>SÍMBOLO / ESCUDO</span>
                        </div>
                    </div>
                </div>
                <div class="page-num">3</div>
            </div>
        </div>
    </div>

    <!-- HOJA 2 (Combate/Compañeros) -->
    <div class="sheet-wrapper">
        <div class="sheet-controls no-print text-white mb-1"><span>Hoja Núcleo 2 (Combate y Compañeros)</span><button onclick="downloadSheet('sheet2')" class="hover:text-blue-300 underline cursor-pointer text-xs ml-2">Descargar</button></div>
        <div id="sheet2" class="sheet-landscape">
            <div class="divider"></div>
            <!-- PÁGINA 2 (Ahora 4) -->
            <div class="page-a5">
                <div class="page-settings">
                     <div class="setting-btn" title="Color de Fondo">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 11l-8-8-8 9.9 8.1 8.1c1.3 1.3 3.3 1.3 4.6 0l2.7-2.7c1.3-1.3 1.3-3.3 0-4.6z"></path><path d="M22 22l-4-4"></path></svg>
                        <input type="color" onchange="this.closest('.page-a5').style.backgroundColor = this.value">
                     </div>
                     <div class="setting-btn" title="Trama/Patrón Individual">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="3" y1="15" x2="21" y2="15"></line><line x1="9" y1="3" x2="9" y2="21"></line><line x1="15" y1="3" x2="15" y2="21"></line></svg>
                        <input type="file" accept="image/*" onchange="applyLocalPattern(this)">
                     </div>
                </div>
                <h2 class="text-title text-center border-b-2 border-black mb-3">Combate y Habilidades</h2>
                <div class="box-border p-2 mb-3 bg-white/60">
                    <div class="grid grid-cols-[1fr_2.5rem_1fr] gap-2 h-6 mb-1 px-2 items-center text-label text-center"><div class="px-2">ARMA / CONJURO</div><div>BONO</div><div class="px-2">DAÑO / TIPO</div></div>
                    <div class="flex flex-col gap-2">
                        <div class="grid grid-cols-[1fr_2.5rem_1fr] gap-2 h-9 px-2"><div class="h-full border border-gray-300 rounded px-2 flex items-center"><input type="text" class="w-full bg-transparent no-line text-stat text-body"></div><div class="h-full border border-gray-300 rounded flex items-center justify-center"><input type="text" class="w-full bg-transparent no-line text-stat text-center"></div><div class="h-full border border-gray-300 rounded px-2 flex items-center"><input type="text" class="w-full bg-transparent no-line text-body"></div></div>
                        <div class="grid grid-cols-[1fr_2.5rem_1fr] gap-2 h-9 px-2"><div class="h-full border border-gray-300 rounded px-2 flex items-center"><input type="text" class="w-full bg-transparent no-line text-stat text-body"></div><div class="h-full border border-gray-300 rounded flex items-center justify-center"><input type="text" class="w-full bg-transparent no-line text-stat text-center"></div><div class="h-full border border-gray-300 rounded px-2 flex items-center"><input type="text" class="w-full bg-transparent no-line text-body"></div></div>
                        <div class="grid grid-cols-[1fr_2.5rem_1fr] gap-2 h-9 px-2"><div class="h-full border border-gray-300 rounded px-2 flex items-center"><input type="text" class="w-full bg-transparent no-line text-stat text-body"></div><div class="h-full border border-gray-300 rounded flex items-center justify-center"><input type="text" class="w-full bg-transparent no-line text-stat text-center"></div><div class="h-full border border-gray-300 rounded px-2 flex items-center"><input type="text" class="w-full bg-transparent no-line text-body"></div></div>
                        <div class="grid grid-cols-[1fr_2.5rem_1fr] gap-2 h-9 px-2"><div class="h-full border border-gray-300 rounded px-2 flex items-center"><input type="text" class="w-full bg-transparent no-line text-stat text-body"></div><div class="h-full border border-gray-300 rounded flex items-center justify-center"><input type="text" class="w-full bg-transparent no-line text-stat text-center"></div><div class="h-full border border-gray-300 rounded px-2 flex items-center"><input type="text" class="w-full bg-transparent no-line text-body"></div></div>
                    </div>
                </div>
                <div class="flex-grow box-border p-3 flex flex-col bg-white/60">
                    <span class="text-label text-center border-b-2 border-black mb-2 block">RASGOS DE CLASE Y TALENTOS</span>
                    <div class="flex flex-col gap-2 mb-2">
                        <div class="flex justify-between items-center border-b border-gray-300 pb-1"><input type="text" class="w-2/3 font-bold bg-transparent no-line text-body"><div class="flex"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"></div></div>
                        <div class="flex justify-between items-center border-b border-gray-300 pb-1"><input type="text" class="w-2/3 font-bold bg-transparent no-line text-body"><div class="flex"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"></div></div>
                        <div class="flex justify-between items-center border-b border-gray-300 pb-1"><input type="text" class="w-2/3 font-bold bg-transparent no-line text-body"><div class="flex"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"></div></div>
                        <div class="flex justify-between items-center border-b border-gray-300 pb-1"><input type="text" class="w-2/3 font-bold bg-transparent no-line text-body"><div class="flex"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"></div></div>
                    </div>
                    <textarea class="w-full flex-grow border-none resize-none p-0 lined-bg bg-transparent text-body"></textarea>
                </div>
                <div class="page-num">4</div>
            </div>
            <!-- PÁGINA 11 (Ahora 13) -->
            <div class="page-a5">
                <div class="page-settings">
                     <div class="setting-btn" title="Color de Fondo">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 11l-8-8-8 9.9 8.1 8.1c1.3 1.3 3.3 1.3 4.6 0l2.7-2.7c1.3-1.3 1.3-3.3 0-4.6z"></path><path d="M22 22l-4-4"></path></svg>
                        <input type="color" onchange="this.closest('.page-a5').style.backgroundColor = this.value">
                     </div>
                     <div class="setting-btn" title="Trama/Patrón Individual">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="3" y1="15" x2="21" y2="15"></line><line x1="9" y1="3" x2="9" y2="21"></line><line x1="15" y1="3" x2="15" y2="21"></line></svg>
                        <input type="file" accept="image/*" onchange="applyLocalPattern(this)">
                     </div>
                </div>
                <h2 class="text-title text-center border-b-2 border-black mb-4">Compañeros y Monturas</h2>
                <div class="flex flex-col gap-4 h-full">
                    <div class="box-border p-3 h-1/2 flex flex-col bg-white/60 rounded">
                        <div class="flex justify-between border-b border-black mb-2 pb-1"><div class="w-1/2"><label class="text-label block">Nombre</label><input type="text" class="font-bold text-stat p-0 w-full bg-transparent no-line"></div><div class="w-1/3"><label class="text-label block text-right">Raza</label><input type="text" class="text-right text-xs p-0 w-full bg-transparent no-line text-body"></div></div>
                        <div class="flex gap-4 mb-2 justify-around"><div class="border border-gray-400 p-1 text-center w-14 bg-white/50 rounded"><span class="text-label block">CA</span><input type="text" class="text-center w-full text-stat border-none no-line bg-transparent"></div><div class="border border-gray-400 p-1 text-center w-14 bg-white/50 rounded"><span class="text-label block">HP</span><input type="text" class="text-center w-full text-stat border-none no-line bg-transparent"></div><div class="border border-gray-400 p-1 text-center w-14 bg-white/50 rounded"><span class="text-label block">VEL</span><input type="text" class="text-center w-full text-stat border-none no-line bg-transparent"></div></div>
                        <div class="flex justify-between text-center mb-2 px-2">
                            <div class="flex flex-col items-center w-8"><span class="text-label">FUE</span><div class="force-border w-full h-6 rounded"><input type="text" class="border-none w-full h-full text-center bg-transparent no-line text-body"></div></div>
                            <div class="flex flex-col items-center w-8"><span class="text-label">DES</span><div class="force-border w-full h-6 rounded"><input type="text" class="border-none w-full h-full text-center bg-transparent no-line text-body"></div></div>
                            <div class="flex flex-col items-center w-8"><span class="text-label">CON</span><div class="force-border w-full h-6 rounded"><input type="text" class="border-none w-full h-full text-center bg-transparent no-line text-body"></div></div>
                            <div class="flex flex-col items-center w-8"><span class="text-label">INT</span><div class="force-border w-full h-6 rounded"><input type="text" class="border-none w-full h-full text-center bg-transparent no-line text-body"></div></div>
                            <div class="flex flex-col items-center w-8"><span class="text-label">SAB</span><div class="force-border w-full h-6 rounded"><input type="text" class="border-none w-full h-full text-center bg-transparent no-line text-body"></div></div>
                            <div class="flex flex-col items-center w-8"><span class="text-label">CAR</span><div class="force-border w-full h-6 rounded"><input type="text" class="border-none w-full h-full text-center bg-transparent no-line text-body"></div></div>
                        </div>
                        <textarea class="flex-grow w-full border-none p-1 resize-none bg-transparent lined-bg text-body"></textarea>
                    </div>
                    <div class="box-border p-3 h-1/2 flex flex-col bg-white/60 rounded">
                        <div class="flex justify-between border-b border-black mb-2 pb-1"><div class="w-1/2"><label class="text-label block">Nombre</label><input type="text" class="font-bold text-stat p-0 w-full bg-transparent no-line"></div><div class="w-1/3"><label class="text-label block text-right">Raza</label><input type="text" class="text-right text-xs p-0 w-full bg-transparent no-line text-body"></div></div>
                        <div class="flex gap-4 mb-2 justify-around"><div class="border border-gray-400 p-1 text-center w-14 bg-white/50 rounded"><span class="text-label block">CA</span><input type="text" class="text-center w-full text-stat border-none no-line bg-transparent"></div><div class="border border-gray-400 p-1 text-center w-14 bg-white/50 rounded"><span class="text-label block">HP</span><input type="text" class="text-center w-full text-stat border-none no-line bg-transparent"></div><div class="border border-gray-400 p-1 text-center w-14 bg-white/50 rounded"><span class="text-label block">VEL</span><input type="text" class="text-center w-full text-stat border-none no-line bg-transparent"></div></div>
                        <div class="flex justify-between text-center mb-2 px-2">
                            <div class="flex flex-col items-center w-8"><span class="text-label">FUE</span><div class="force-border w-full h-6 rounded"><input type="text" class="border-none w-full h-full text-center bg-transparent no-line text-body"></div></div>
                            <div class="flex flex-col items-center w-8"><span class="text-label">DES</span><div class="force-border w-full h-6 rounded"><input type="text" class="border-none w-full h-full text-center bg-transparent no-line text-body"></div></div>
                            <div class="flex flex-col items-center w-8"><span class="text-label">CON</span><div class="force-border w-full h-6 rounded"><input type="text" class="border-none w-full h-full text-center bg-transparent no-line text-body"></div></div>
                            <div class="flex flex-col items-center w-8"><span class="text-label">INT</span><div class="force-border w-full h-6 rounded"><input type="text" class="border-none w-full h-full text-center bg-transparent no-line text-body"></div></div>
                            <div class="flex flex-col items-center w-8"><span class="text-label">SAB</span><div class="force-border w-full h-6 rounded"><input type="text" class="border-none w-full h-full text-center bg-transparent no-line text-body"></div></div>
                            <div class="flex flex-col items-center w-8"><span class="text-label">CAR</span><div class="force-border w-full h-6 rounded"><input type="text" class="border-none w-full h-full text-center bg-transparent no-line text-body"></div></div>
                        </div>
                        <textarea class="flex-grow w-full border-none p-1 resize-none bg-transparent lined-bg text-body"></textarea>
                    </div>
                </div>
                <div class="page-num">13</div>
            </div>
        </div>
    </div>

    <!-- HOJA 3 & 10 (Inventario/Notas) -->
    <div class="sheet-wrapper">
        <div class="sheet-controls no-print text-white mb-1"><span>Hoja Núcleo 3 (Inventario y Notas)</span><button onclick="downloadSheet('sheet3')" class="hover:text-blue-300 underline cursor-pointer text-xs ml-2">Descargar</button></div>
        <div id="sheet3" class="sheet-landscape">
            <div class="divider"></div>
            <div class="page-a5">
                <div class="page-settings">
                     <div class="setting-btn" title="Color de Fondo">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 11l-8-8-8 9.9 8.1 8.1c1.3 1.3 3.3 1.3 4.6 0l2.7-2.7c1.3-1.3 1.3-3.3 0-4.6z"></path><path d="M22 22l-4-4"></path></svg>
                        <input type="color" onchange="this.closest('.page-a5').style.backgroundColor = this.value">
                     </div>
                     <div class="setting-btn" title="Trama/Patrón Individual">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="3" y1="15" x2="21" y2="15"></line><line x1="9" y1="3" x2="9" y2="21"></line><line x1="15" y1="3" x2="15" y2="21"></line></svg>
                        <input type="file" accept="image/*" onchange="applyLocalPattern(this)">
                     </div>
                </div>
                 <h2 class="text-title text-center border-b-2 border-black mb-4">Notas Adicionales</h2>
                 <div class="h-full w-full lined-bg box-border p-4 bg-white/60"></div>
                 <div class="page-num">12</div>
            </div>
            <div class="page-a5">
                <div class="page-settings">
                     <div class="setting-btn" title="Color de Fondo">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 11l-8-8-8 9.9 8.1 8.1c1.3 1.3 3.3 1.3 4.6 0l2.7-2.7c1.3-1.3 1.3-3.3 0-4.6z"></path><path d="M22 22l-4-4"></path></svg>
                        <input type="color" onchange="this.closest('.page-a5').style.backgroundColor = this.value">
                     </div>
                     <div class="setting-btn" title="Trama/Patrón Individual">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="3" y1="15" x2="21" y2="15"></line><line x1="9" y1="3" x2="9" y2="21"></line><line x1="15" y1="3" x2="15" y2="21"></line></svg>
                        <input type="file" accept="image/*" onchange="applyLocalPattern(this)">
                     </div>
                </div>
                <div class="w-full box-border p-3 flex flex-col h-full">
                     <div class="flex justify-between border-b border-gray-300 pb-2 mb-3 gap-2 bg-white/60 p-1 shadow-sm">
                        <div class="flex-1 text-center bg-gray-100 rounded p-1 flex flex-col items-center justify-center gap-1">
                            <span class="text-label block">PC</span>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#b87333" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M12 6v12M6 12h12"></path></svg>
                            <input type="text" class="text-center font-bold no-line bg-transparent text-body w-full">
                        </div>
                        <div class="flex-1 text-center bg-gray-100 rounded p-1 flex flex-col items-center justify-center gap-1">
                            <span class="text-label block">PP</span>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#C0C0C0" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M16 16l-8-8"></path></svg>
                            <input type="text" class="text-center font-bold no-line bg-transparent text-body w-full">
                        </div>
                        <div class="flex-1 text-center bg-yellow-50 rounded p-1 border border-yellow-200 flex flex-col items-center justify-center gap-1">
                            <span class="text-label block">PO</span>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#FFD700" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="4"></circle></svg>
                            <input type="text" class="text-center font-bold no-line bg-transparent text-body w-full">
                        </div>
                        <div class="flex-1 text-center bg-gray-100 rounded p-1 flex flex-col items-center justify-center gap-1">
                            <span class="text-label block">PE</span>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#4682B4" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><rect x="9" y="9" width="6" height="6"></rect></svg>
                            <input type="text" class="text-center font-bold no-line bg-transparent text-body w-full">
                        </div>
                        <div class="flex-1 text-center bg-gray-100 rounded p-1 flex flex-col items-center justify-center gap-1">
                            <span class="text-label block">PT</span>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#E5E4E2" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M12 2l2 8 8 2-8 2-2 8-2-8-8-2 8-2z"></path></svg>
                            <input type="text" class="text-center font-bold no-line bg-transparent text-body w-full">
                        </div>
                    </div>
                    <textarea class="w-full flex-grow border-none resize-none p-0 leading-tight lined-bg bg-transparent mb-2 text-body"></textarea>
                    <div class="mt-2 border-t border-black pt-2 flex gap-2 h-16">
                        <div class="w-12 border border-gray-400 rounded bg-white/60 flex flex-col items-center justify-center">
                            <span class="text-label block">CANT.</span>
                            <input type="text" class="text-center font-bold text-xl no-line bg-transparent w-full h-full p-0 text-body">
                        </div>
                        <div class="flex-grow border border-gray-400 rounded bg-white/60 p-1 relative">
                             <span class="text-label block absolute top-1 left-1 bg-white/80 px-1">MUNICIÓN / TIPO</span>
                             <textarea class="w-full h-full border-none resize-none bg-transparent pt-4 text-body"></textarea>
                        </div>
                    </div>
                    <div class="mt-2 border-t border-black pt-2 flex gap-2 h-16">
                        <div class="w-12 border border-gray-400 rounded bg-white/60 flex flex-col items-center justify-center">
                            <span class="text-label block">CANT.</span>
                            <input type="text" class="text-center font-bold text-xl no-line bg-transparent w-full h-full p-0 text-body">
                        </div>
                        <div class="flex-grow border border-gray-400 rounded bg-white/60 p-1 relative">
                            <span class="text-label block absolute top-1 left-1 bg-white/80 px-1">POCIONES Y CURACIÓN</span>
                            <textarea class="w-full h-full border-none resize-none bg-transparent pt-4 text-body"></textarea>
                        </div>
                    </div>
                </div>
                <div class="page-num">5</div>
            </div>
        </div>
    </div>

    <!-- HOJA 4 -->
    <div class="sheet-wrapper">
        <div class="sheet-controls no-print text-white mb-1"><span>Hoja Núcleo 4 (Magia/Técnicas y Bio)</span><button onclick="downloadSheet('sheet4')" class="hover:text-blue-300 underline cursor-pointer text-xs ml-2">Descargar</button></div>
        <div id="sheet4" class="sheet-landscape">
            <div class="divider"></div>
            <!-- PÁGINA 6 -->
            <div class="page-a5">
                 <div class="page-settings">
                     <div class="setting-btn" title="Color de Fondo">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 11l-8-8-8 9.9 8.1 8.1c1.3 1.3 3.3 1.3 4.6 0l2.7-2.7c1.3-1.3 1.3-3.3 0-4.6z"></path><path d="M22 22l-4-4"></path></svg>
                        <input type="color" onchange="this.closest('.page-a5').style.backgroundColor = this.value">
                     </div>
                     <div class="setting-btn" title="Trama/Patrón Individual">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="3" y1="15" x2="21" y2="15"></line><line x1="9" y1="3" x2="9" y2="21"></line><line x1="15" y1="3" x2="15" y2="21"></line></svg>
                        <input type="file" accept="image/*" onchange="applyLocalPattern(this)">
                     </div>
                </div>
                 <!-- HEADER UNIFICADO (Solo Mágico) -->
                 <h2 class="text-title text-center border-b-2 border-black mb-2 magic-content">Libro de Hechizos</h2>

                 <!-- PANEL DE GESTIÓN MÁGICA -->
                 <div class="magic-content mb-2 box-border p-1 bg-white/60">
                    <div class="flex gap-2 h-28">
                        <!-- Izquierda -->
                        <div class="w-20 flex flex-col gap-1 justify-between py-1">
                             <div class="flex flex-col items-center h-1/2">
                                <span class="text-label mb-1">Preparados</span>
                                <div class="box-border w-full flex-grow bg-white/60 relative">
                                    <input type="text" class="absolute inset-0 w-full h-full text-center text-stat bg-transparent border-none focus:ring-0">
                                </div>
                             </div>
                             <div class="flex flex-col items-center h-1/2">
                                <span class="text-label mb-1">Conocidos</span>
                                <div class="box-border w-full flex-grow bg-white/60 relative">
                                    <input type="text" class="absolute inset-0 w-full h-full text-center text-stat bg-transparent border-none focus:ring-0">
                                </div>
                             </div>
                        </div>

                        <!-- Centro -->
                        <div class="flex-grow flex flex-col">
                            <div class="flex-grow grid grid-cols-3 divide-x divide-gray-300">
                                <div class="px-1 flex flex-col justify-between py-1">
                                    <div class="flex items-center justify-between text-label"><span class="w-3">1</span><input type="text" class="w-5 border-b border-black text-center h-3 bg-transparent"><div class="flex gap-0.5"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"></div></div>
                                    <div class="flex items-center justify-between text-label"><span class="w-3">2</span><input type="text" class="w-5 border-b border-black text-center h-3 bg-transparent"><div class="flex gap-0.5"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"></div></div>
                                    <div class="flex items-center justify-between text-label"><span class="w-3">3</span><input type="text" class="w-5 border-b border-black text-center h-3 bg-transparent"><div class="flex gap-0.5"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"></div></div>
                                </div>
                                <div class="px-1 flex flex-col justify-between py-1">
                                    <div class="flex items-center justify-between text-label"><span class="w-3">4</span><input type="text" class="w-5 border-b border-black text-center h-3 bg-transparent"><div class="flex gap-0.5"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"></div></div>
                                    <div class="flex items-center justify-between text-label"><span class="w-3">5</span><input type="text" class="w-5 border-b border-black text-center h-3 bg-transparent"><div class="flex gap-0.5"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"></div></div>
                                    <div class="flex items-center justify-between text-label"><span class="w-3">6</span><input type="text" class="w-5 border-b border-black text-center h-3 bg-transparent"><div class="flex gap-0.5"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"></div></div>
                                </div>
                                <div class="px-1 flex flex-col justify-between py-1">
                                    <div class="flex items-center justify-between text-label"><span class="w-3">7</span><input type="text" class="w-5 border-b border-black text-center h-3 bg-transparent"><div class="flex gap-0.5"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"></div></div>
                                    <div class="flex items-center justify-between text-label"><span class="w-3">8</span><input type="text" class="w-5 border-b border-black text-center h-3 bg-transparent"><div class="flex gap-0.5"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"></div></div>
                                    <div class="flex items-center justify-between text-label"><span class="w-3">9</span><input type="text" class="w-5 border-b border-black text-center h-3 bg-transparent"><div class="flex gap-0.5"><input type="checkbox" class="hex-check"></div></div>
                                </div>
                            </div>
                        </div>

                        <!-- Derecha -->
                        <div class="w-20 flex flex-col gap-1 justify-between py-1 items-center">
                             <div class="flex flex-col items-center">
                                <span class="text-label mb-1">Concentración</span>
                                <div class="w-10 h-10 rounded-full border-2 border-black flex items-center justify-center bg-white/60 relative shadow-sm">
                                    <input type="checkbox" class="appearance-none w-8 h-8 rounded-full checked:bg-black border border-gray-300 cursor-pointer absolute m-auto inset-0">
                                </div>
                             </div>
                             <div class="flex flex-col items-center w-full h-full justify-end">
                                <span class="text-label mb-0.5 text-center leading-none text-[10px]">TRUCOS<br>CONOCIDOS</span>
                                <div class="box-border w-full h-8 bg-white/60 relative">
                                    <input type="text" class="absolute inset-0 w-full h-full text-center text-stat bg-transparent border-none">
                                </div>
                             </div>
                        </div>
                    </div>
                 </div>

                 <!-- HEADER UNIFICADO (SACROS) -->
                 <h2 class="text-title text-center border-b-2 border-black mb-2 sacred-content">Poderes Divinos y Naturales</h2>

                 <!-- PANEL DE GESTIÓN SACROS -->
                 <div class="sacred-content mb-2 box-border p-1 bg-white/60">
                    <div class="flex gap-2 h-28">
                        <div class="w-20 flex flex-col gap-1 justify-center py-1">
                             <div class="flex flex-col items-center h-full pt-2">
                                <span class="text-label mb-1">Preparados</span>
                                <div class="box-border w-full flex-grow bg-white/60 relative">
                                    <input type="text" class="absolute inset-0 w-full h-full text-center text-stat bg-transparent border-none focus:ring-0">
                                </div>
                             </div>
                        </div>

                        <div class="flex-grow flex flex-col">
                            <div class="flex-grow grid grid-cols-3 divide-x divide-gray-300">
                                <div class="px-1 flex flex-col justify-between py-1">
                                    <div class="flex items-center justify-between text-label"><span class="w-3">1</span><input type="text" class="w-5 border-b border-black text-center h-3 bg-transparent"><div class="flex gap-0.5"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"></div></div>
                                    <div class="flex items-center justify-between text-label"><span class="w-3">2</span><input type="text" class="w-5 border-b border-black text-center h-3 bg-transparent"><div class="flex gap-0.5"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"></div></div>
                                    <div class="flex items-center justify-between text-label"><span class="w-3">3</span><input type="text" class="w-5 border-b border-black text-center h-3 bg-transparent"><div class="flex gap-0.5"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"></div></div>
                                </div>
                                <div class="px-1 flex flex-col justify-between py-1">
                                    <div class="flex items-center justify-between text-label"><span class="w-3">4</span><input type="text" class="w-5 border-b border-black text-center h-3 bg-transparent"><div class="flex gap-0.5"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"></div></div>
                                    <div class="flex items-center justify-between text-label"><span class="w-3">5</span><input type="text" class="w-5 border-b border-black text-center h-3 bg-transparent"><div class="flex gap-0.5"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"></div></div>
                                    <div class="flex items-center justify-between text-label"><span class="w-3">6</span><input type="text" class="w-5 border-b border-black text-center h-3 bg-transparent"><div class="flex gap-0.5"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"></div></div>
                                </div>
                                <div class="px-1 flex flex-col justify-between py-1">
                                    <div class="flex items-center justify-between text-label"><span class="w-3">7</span><input type="text" class="w-5 border-b border-black text-center h-3 bg-transparent"><div class="flex gap-0.5"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"></div></div>
                                    <div class="flex items-center justify-between text-label"><span class="w-3">8</span><input type="text" class="w-5 border-b border-black text-center h-3 bg-transparent"><div class="flex gap-0.5"><input type="checkbox" class="hex-check"><input type="checkbox" class="hex-check"></div></div>
                                    <div class="flex items-center justify-between text-label"><span class="w-3">9</span><input type="text" class="w-5 border-b border-black text-center h-3 bg-transparent"><div class="flex gap-0.5"><input type="checkbox" class="hex-check"></div></div>
                                </div>
                            </div>
                        </div>

                        <div class="w-24 flex flex-col gap-1 justify-between py-1 pl-1 border-l border-gray-300">
                             <div class="flex flex-col items-center h-1/2">
                                <span class="text-[10px] font-bold text-center leading-tight">CANALIZAR /<br>FORMA SALVAJE</span>
                                <div class="flex flex-wrap justify-center gap-1 mt-1">
                                    <div class="relative w-4 h-4"><input type="checkbox" class="icon-checkbox"><svg class="absolute inset-0 w-full h-full pointer-events-none" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2"><circle cx="12" cy="12" r="5" /><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" /></svg></div>
                                    <div class="relative w-4 h-4"><input type="checkbox" class="icon-checkbox"><svg class="absolute inset-0 w-full h-full pointer-events-none" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2"><circle cx="12" cy="12" r="5" /><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" /></svg></div>
                                    <div class="relative w-4 h-4"><input type="checkbox" class="icon-checkbox"><svg class="absolute inset-0 w-full h-full pointer-events-none" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2"><circle cx="12" cy="12" r="5" /><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" /></svg></div>
                                    <div class="relative w-4 h-4"><input type="checkbox" class="icon-checkbox"><svg class="absolute inset-0 w-full h-full pointer-events-none" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2"><circle cx="12" cy="12" r="5" /><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" /></svg></div>
                                </div>
                             </div>
                             <div class="flex flex-col items-center w-full h-1/2 justify-end">
                                <span class="text-[10px] font-bold text-center leading-none mb-0.5">POOL SANACIÓN<br>(PALADÍN/CLÉRIGO)</span>
                                <div class="box-border w-full h-6 bg-white/60 relative">
                                    <input type="text" class="absolute inset-0 w-full h-full text-center text-body font-bold bg-transparent border-none">
                                </div>
                             </div>
                        </div>
                    </div>
                 </div>

                 <!-- CONTENIDO MÁGICO P4 -->
                 <div class="magic-content flex-grow flex flex-col gap-4">
                     <script>
                        for(let i=0; i<3; i++) {
                            document.write(`
                            <div class="spell-card flex-1 flex gap-2">
                                <div class="w-10 flex flex-col items-center justify-start pt-1">
                                    <label class="text-label mb-1 block">NIVEL</label>
                                    <div class="spell-level-diamond"><input class="spell-level-input"></div>
                                </div>
                                <div class="flex-grow flex flex-col gap-1">
                                    <div class="flex items-end gap-1 mb-1">
                                        <label class="text-label">NOMBRE</label>
                                        <input class="border-b border-black flex-grow h-6 text-title">
                                    </div>
                                    <div class="flex gap-1 mb-1 text-[10px]"> <!-- FIX APPLIED HERE -->
                                        <div class="flex items-end gap-0.5 flex-1"><label class="text-label text-[9px]">CAST:</label><input class="border-b border-gray-400 w-full h-4 text-body text-center min-w-0"></div>
                                        <div class="flex items-end gap-0.5 flex-1"><label class="text-label text-[9px]">DUR:</label><input class="border-b border-gray-400 w-full h-4 text-body text-center min-w-0"></div>
                                        <div class="flex items-end gap-0.5 flex-1"><label class="text-label text-[9px]">RNG:</label><input class="border-b border-gray-400 w-full h-4 text-body text-center min-w-0"></div>
                                        <div class="flex items-center gap-0.5 w-auto justify-end"><span class="text-label text-[9px] mr-0.5">COMPS:</span><label class="flex items-center gap-0.5 text-label text-[8px]">V<input type="checkbox" class="comp-check" data-label="V"></label><label class="flex items-center gap-0.5 text-label text-[8px]">S<input type="checkbox" class="comp-check" data-label="S"></label><label class="flex items-center gap-0.5 text-label text-[8px]">M<input type="checkbox" class="comp-check" data-label="M"></label></div>
                                    </div>
                                    <div class="relative mt-2">
                                        <label class="text-label absolute top-[-8px] left-0 bg-white/60 px-1">DESCRIPCIÓN</label>
                                        <div class="w-full lined-bg pt-2 desc-4-lines">
                                            <textarea class="w-full h-full bg-transparent resize-none border-none text-body p-0"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            `);
                        }
                     </script>
                 </div>

                 <!-- REPETIMOS PARA SACROS -->
                 <div class="sacred-content flex-grow flex flex-col gap-4">
                     <script>
                        for(let i=0; i<3; i++) {
                            document.write(`
                            <div class="spell-card flex-1 flex gap-2">
                                <div class="w-10 flex flex-col items-center justify-start pt-1"><label class="text-label mb-1 block">NIVEL</label><div class="spell-level-diamond"><input class="spell-level-input"></div></div>
                                <div class="flex-grow flex flex-col gap-1">
                                    <div class="flex items-end gap-1 mb-1"><label class="text-label">NOMBRE</label><input class="border-b border-black flex-grow h-6 text-title"></div>
                                    <div class="flex gap-1 mb-1 text-[10px]"> <!-- FIX APPLIED HERE -->
                                        <div class="flex items-end gap-0.5 flex-1"><label class="text-label text-[9px]">CAST:</label><input class="border-b border-gray-400 w-full h-4 text-body text-center min-w-0"></div>
                                        <div class="flex items-end gap-0.5 flex-1"><label class="text-label text-[9px]">DUR:</label><input class="border-b border-gray-400 w-full h-4 text-body text-center min-w-0"></div>
                                        <div class="flex items-end gap-0.5 flex-1"><label class="text-label text-[9px]">RNG:</label><input class="border-b border-gray-400 w-full h-4 text-body text-center min-w-0"></div>
                                        <div class="flex items-center gap-0.5 w-auto justify-end"><span class="text-label text-[9px] mr-0.5">COMPS:</span><label class="flex items-center gap-0.5 text-label text-[8px]">V<input type="checkbox" class="comp-check" data-label="V"></label><label class="flex items-center gap-0.5 text-label text-[8px]">S<input type="checkbox" class="comp-check" data-label="S"></label><label class="flex items-center gap-0.5 text-label text-[8px]">M<input type="checkbox" class="comp-check" data-label="M"></label></div>
                                    </div>
                                    <div class="relative mt-2"><label class="text-label absolute top-[-8px] left-0 bg-white/60 px-1">DESCRIPCIÓN</label><div class="w-full lined-bg pt-2 desc-4-lines"><textarea class="w-full h-full bg-transparent resize-none border-none text-body p-0"></textarea></div></div>
                                </div>
                            </div>
                            `);
                        }
                     </script>
                 </div>

                <!-- CONTENIDO MARCIAL P4 -->
                <div class="martial-content flex-grow flex flex-col gap-2 mb-6">
                     <h2 class="text-title text-center border-b-2 border-black mb-2">Técnicas y Maniobras</h2>
                     <div class="flex-grow flex flex-col gap-1 h-full">
                         <script>
                            for(let i=0; i<6; i++) {
                                document.write(`
                                <div class="bg-white/60 p-1 border-b border-gray-400 flex-1 flex flex-col">
                                   <div class="flex justify-between items-end mb-1 flex-shrink-0">
                                       <div class="w-2/3">
                                           <span class="text-[10px] uppercase font-bold text-gray-500 block mb-0 leading-none">Nombre de Habilidad / Maniobra</span>
                                           <input type="text" class="font-bold w-full text-body no-line border-b border-black p-0">
                                       </div>
                                       <div class="flex flex-col items-end">
                                           <span class="text-[10px] uppercase font-bold text-gray-600">Usos por día</span>
                                           <div class="flex gap-1">
                                               <div class="relative w-4 h-4"><input type="checkbox" class="icon-checkbox"><svg class="absolute inset-0 w-full h-full pointer-events-none" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2"><path d="M14.5 2.5l5 5-9 9H8v-2.5L14.5 2.5zM5 16l3 3M3 21l3-3" /></svg></div>
                                               <div class="relative w-4 h-4"><input type="checkbox" class="icon-checkbox"><svg class="absolute inset-0 w-full h-full pointer-events-none" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2"><path d="M14.5 2.5l5 5-9 9H8v-2.5L14.5 2.5zM5 16l3 3M3 21l3-3" /></svg></div>
                                               <div class="relative w-4 h-4"><input type="checkbox" class="icon-checkbox"><svg class="absolute inset-0 w-full h-full pointer-events-none" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2"><path d="M14.5 2.5l5 5-9 9H8v-2.5L14.5 2.5zM5 16l3 3M3 21l3-3" /></svg></div>
                                               <div class="relative w-4 h-4"><input type="checkbox" class="icon-checkbox"><svg class="absolute inset-0 w-full h-full pointer-events-none" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2"><path d="M14.5 2.5l5 5-9 9H8v-2.5L14.5 2.5zM5 16l3 3M3 21l3-3" /></svg></div>
                                               <div class="relative w-4 h-4"><input type="checkbox" class="icon-checkbox"><svg class="absolute inset-0 w-full h-full pointer-events-none" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2"><path d="M14.5 2.5l5 5-9 9H8v-2.5L14.5 2.5zM5 16l3 3M3 21l3-3" /></svg></div>
                                           </div>
                                       </div>
                                   </div>
                                   <div class="w-full flex-grow lined-bg relative">
                                        <textarea class="w-full h-full bg-transparent resize-none border-none text-body p-0 absolute inset-0 leading-[20px]"></textarea>
                                   </div>
                                </div>
                                `);
                            }
                         </script>
                     </div>
                </div>

                <!-- CONTENIDO EXPERTOS -->
                <div class="expert-content flex-grow flex flex-col gap-2 mb-6">
                     <h2 class="text-title text-center border-b-2 border-black mb-2">Trucos de Oficio y Herramientas</h2>
                     <div class="flex-grow flex flex-col gap-1 h-full">
                         <script>
                            for(let i=0; i<6; i++) {
                                document.write(`
                                <div class="bg-white/60 p-1 border-b border-gray-400 flex-1 flex flex-col">
                                   <div class="flex justify-between items-end mb-1 flex-shrink-0">
                                       <div class="w-2/3"><span class="text-[10px] uppercase font-bold text-gray-500 block mb-0 leading-none">Herramienta / Habilidad Especial</span><input type="text" class="font-bold w-full text-body no-line border-b border-black p-0"></div>
                                       <div class="flex flex-col items-end"><span class="text-[10px] uppercase font-bold text-gray-600">Dados de Experto / Usos</span>
                                           <div class="flex gap-1">
                                               <div class="relative w-4 h-4"><input type="checkbox" class="icon-checkbox"><svg class="absolute inset-0 w-full h-full pointer-events-none" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z" /></svg></div>
                                               <div class="relative w-4 h-4"><input type="checkbox" class="icon-checkbox"><svg class="absolute inset-0 w-full h-full pointer-events-none" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z" /></svg></div>
                                               <div class="relative w-4 h-4"><input type="checkbox" class="icon-checkbox"><svg class="absolute inset-0 w-full h-full pointer-events-none" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z" /></svg></div>
                                               <div class="relative w-4 h-4"><input type="checkbox" class="icon-checkbox"><svg class="absolute inset-0 w-full h-full pointer-events-none" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z" /></svg></div>
                                           </div>
                                       </div>
                                   </div>
                                   <div class="w-full flex-grow lined-bg relative"><textarea class="w-full h-full bg-transparent resize-none border-none text-body p-0 absolute inset-0 leading-[20px]"></textarea></div>
                                </div>
                                `);
                            }
                         </script>
                     </div>
                </div>

                <div class="page-num">6</div>
            </div>
            
            <!-- PÁGINA 11 -->
            <div class="page-a5">
                <div class="page-settings">
                     <div class="setting-btn" title="Color de Fondo">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 11l-8-8-8 9.9 8.1 8.1c1.3 1.3 3.3 1.3 4.6 0l2.7-2.7c1.3-1.3 1.3-3.3 0-4.6z"></path><path d="M22 22l-4-4"></path></svg>
                        <input type="color" onchange="this.closest('.page-a5').style.backgroundColor = this.value">
                     </div>
                     <div class="setting-btn" title="Trama/Patrón Individual">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="3" y1="15" x2="21" y2="15"></line><line x1="9" y1="3" x2="9" y2="21"></line><line x1="15" y1="3" x2="15" y2="21"></line></svg>
                        <input type="file" accept="image/*" onchange="applyLocalPattern(this)">
                     </div>
                </div>
                 <h2 class="text-title text-center border-b-2 border-black mb-3">Biografía y Apariencia</h2>
                 <div class="flex flex-col gap-3 h-full">
                     <div class="flex gap-3">
                         <div class="box-border p-2 w-1/3 h-44 flex flex-col items-center justify-center border-dashed bg-gray-50/60"><span class="text-label text-center text-gray-400">Pegar Retrato</span></div>
                         <div class="w-2/3 flex flex-col gap-2 justify-center">
                             <div class="flex gap-3"><div class="w-full"><label class="text-label">Edad</label><input type="text" class="border-b border-black w-full no-line text-body"></div><div class="w-full"><label class="text-label">Altura</label><input type="text" class="border-b border-black w-full no-line text-body"></div></div>
                             <div class="flex gap-3"><div class="w-full"><label class="text-label">Peso</label><input type="text" class="border-b border-black w-full no-line text-body"></div><div class="w-full"><label class="text-label">Ojos</label><input type="text" class="border-b border-black w-full no-line text-body"></div></div>
                             <div class="flex gap-3"><div class="w-full"><label class="text-label">Piel</label><input type="text" class="border-b border-black w-full no-line text-body"></div><div class="w-full"><label class="text-label">Cabello</label><input type="text" class="border-b border-black w-full no-line text-body"></div></div>
                             <textarea class="w-full h-full border border-gray-300 p-2 resize-none rounded bg-transparent text-body"></textarea>
                         </div>
                     </div>
                     <div class="box-border p-3 flex-grow"><span class="text-label block mb-2 border-b border-gray-300 pb-1">Historia del Personaje</span><textarea class="w-full h-full border-none resize-none lined-bg bg-transparent text-body"></textarea></div>
                 </div>
                <div class="page-num">11</div>
            </div>
        </div>
    </div>

    <!-- HOJA 5: P8 & P5 -->
    <div class="sheet-wrapper">
        <div class="sheet-controls no-print text-white mb-1"><span>Hoja Núcleo 5 (Reglas y Talentos)</span><button onclick="downloadSheet('sheet5')" class="hover:text-blue-300 underline cursor-pointer text-xs ml-2">Descargar</button></div>
        <div id="sheet5" class="sheet-landscape">
            <div class="divider"></div>
            <!-- PÁGINA 8 -->
            <div class="page-a5">
                <div class="page-settings">
                     <div class="setting-btn" title="Color de Fondo">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 11l-8-8-8 9.9 8.1 8.1c1.3 1.3 3.3 1.3 4.6 0l2.7-2.7c1.3-1.3 1.3-3.3 0-4.6z"></path><path d="M22 22l-4-4"></path></svg>
                        <input type="color" onchange="this.closest('.page-a5').style.backgroundColor = this.value">
                     </div>
                     <div class="setting-btn" title="Trama/Patrón Individual">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="3" y1="15" x2="21" y2="15"></line><line x1="9" y1="3" x2="9" y2="21"></line><line x1="15" y1="3" x2="15" y2="21"></line></svg>
                        <input type="file" accept="image/*" onchange="applyLocalPattern(this)">
                     </div>
                </div>
                <h2 class="text-title text-center border-b-2 border-black mb-3">Ayuda de Reglas</h2>
                <div class="flex flex-col h-full gap-3">
                    <!-- ACCIONES -->
                    <div class="rules-box">
                        <span class="rules-title text-center">Acciones en Combate</span>
                        <div class="grid grid-cols-2 gap-x-4 gap-y-1 px-1">
                            <div class="ref-row"><span class="ref-key">Atacar</span><span class="ref-val">Realizar un ataque cuerpo a cuerpo o a distancia.</span></div>
                            <div class="ref-row"><span class="ref-key">Lanzar Conj.</span><span class="ref-val">Lanzar hechizo según tiempo (gralm. 1 acción).</span></div>
                            <div class="ref-row"><span class="ref-key">Esprintar</span><span class="ref-val">Ganas movimiento extra igual a tu velocidad actual.</span></div>
                            <div class="ref-row"><span class="ref-key">Destrabarse</span><span class="ref-val">Movimiento no provoca ataques de oportunidad.</span></div>
                            <div class="ref-row"><span class="ref-key">Esquivar</span><span class="ref-val">Ataques contra ti con Desventaja. Ventaja en Salv. DES.</span></div>
                            <div class="ref-row"><span class="ref-key">Ayudar</span><span class="ref-val">Otorga ventaja a aliado en su próxima prueba/ataque.</span></div>
                            <div class="ref-row"><span class="ref-key">Buscar</span><span class="ref-val">Dedicar tu acción a percibir algo o investigar.</span></div>
                            <div class="ref-row"><span class="ref-key">Usar Obj.</span><span class="ref-val">Interactuar con objeto que requiera acción.</span></div>
                            <div class="ref-row"><span class="ref-key">Esconderse</span><span class="ref-val">Prueba de Sigilo para ocultarte (si no eres visto).</span></div>
                            <div class="ref-row"><span class="ref-key">Preparar</span><span class="ref-val">Retener acción para usarla como reacción.</span></div>
                        </div>
                    </div>
                    <!-- CONDICIONES -->
                    <div class="rules-box flex-grow">
                        <span class="rules-title text-center">Estados y Condiciones</span>
                        <div class="flex flex-col gap-1 px-1 leading-tight overflow-hidden h-full justify-between">
                            <div class="ref-row"><span class="ref-key">Agarrado</span><span class="ref-val">Velocidad 0. Termina si agarrador es incapacitado/te liberan.</span></div>
                            <div class="ref-row"><span class="ref-key">Asustado</span><span class="ref-val">Desventaja pruebas/ataques si ves fuente. No puedes acercarte.</span></div>
                            <div class="ref-row"><span class="ref-key">Aturdido</span><span class="ref-val">Incapacitado. Fallo auto. Salv FUE/DES. Ataques vs ti con Ventaja.</span></div>
                            <div class="ref-row"><span class="ref-key">Cegado</span><span class="ref-val">Fallo auto visión. Ataques vs ti con Ventaja. Tus ataques con Desventaja.</span></div>
                            <div class="ref-row"><span class="ref-key">Derribado</span><span class="ref-val">Solo gatear. Tus ataques Desventaja. Vs ti: Ventaja (cerca), Desv (lejos).</span></div>
                            <div class="ref-row"><span class="ref-key">Envenenado</span><span class="ref-val">Desventaja en tiradas de ataque y pruebas de habilidad.</span></div>
                            <div class="ref-row"><span class="ref-key">Hechizado</span><span class="ref-val">No puedes atacar a encantador. Él tiene Ventaja social contra ti.</span></div>
                            <div class="ref-row"><span class="ref-key">Incapacitado</span><span class="ref-val">No puedes tomar acciones, acciones adicionales ni reacciones.</span></div>
                            <div class="ref-row"><span class="ref-key">Inconsciente</span><span class="ref-val">Incapacitado/Derribado. Fallo Salv FUE/DES. Vs ti: Ventaja y Crítico (5 pies).</span></div>
                            <div class="ref-row"><span class="ref-key">Invisible</span><span class="ref-val">Imposible ver. Ataques vs ti con Desventaja. Tus ataques con Ventaja.</span></div>
                            <div class="ref-row"><span class="ref-key">Paralizado</span><span class="ref-val">Incapacitado/Inmóvil. Fallo Salv FUE/DES. Vs ti: Ventaja y Crítico (5 pies).</span></div>
                            <div class="ref-row"><span class="ref-key">Restringido</span><span class="ref-val">Velocidad 0. Vs ti: Ventaja. Tus ataques: Desventaja. Desventaja Salv DES.</span></div>
                        </div>
                    </div>
                </div>
                <div class="page-num">10</div>
            </div>
            <!-- PÁGINA 5 -->
            <div class="page-a5">
                <div class="page-settings">
                     <div class="setting-btn" title="Color de Fondo">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 11l-8-8-8 9.9 8.1 8.1c1.3 1.3 3.3 1.3 4.6 0l2.7-2.7c1.3-1.3 1.3-3.3 0-4.6z"></path><path d="M22 22l-4-4"></path></svg>
                        <input type="color" onchange="this.closest('.page-a5').style.backgroundColor = this.value">
                     </div>
                     <div class="setting-btn" title="Trama/Patrón Individual">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="3" y1="15" x2="21" y2="15"></line><line x1="9" y1="3" x2="9" y2="21"></line><line x1="15" y1="3" x2="15" y2="21"></line></svg>
                        <input type="file" accept="image/*" onchange="applyLocalPattern(this)">
                     </div>
                </div>
                <!-- CONTENIDO MÁGICO P5 -->
                <div class="magic-content flex flex-col h-full gap-1">
                    <script>
                        for(let i=0; i<4; i++) {
                            document.write(`
                            <div class="spell-card flex-1 flex gap-2">
                                <div class="w-10 flex flex-col items-center justify-start pt-1"><label class="text-label mb-1 block">NIVEL</label><div class="spell-level-diamond"><input class="spell-level-input"></div></div>
                                <div class="flex-grow flex flex-col gap-1">
                                    <div class="flex items-end gap-1 mb-1"><label class="text-label">NOMBRE</label><input class="border-b border-black flex-grow h-6 text-title"></div>
                                    <div class="flex gap-1 mb-1 text-[10px]"> <!-- FIX APPLIED HERE -->
                                        <div class="flex items-end gap-0.5 flex-1"><label class="text-label text-[9px]">CAST:</label><input class="border-b border-gray-400 w-full h-4 text-body text-center min-w-0"></div>
                                        <div class="flex items-end gap-0.5 flex-1"><label class="text-label text-[9px]">DUR:</label><input class="border-b border-gray-400 w-full h-4 text-body text-center min-w-0"></div>
                                        <div class="flex items-end gap-0.5 flex-1"><label class="text-label text-[9px]">RNG:</label><input class="border-b border-gray-400 w-full h-4 text-body text-center min-w-0"></div>
                                        <div class="flex items-center gap-0.5 w-auto justify-end"><span class="text-label text-[9px] mr-0.5">COMPS:</span><label class="flex items-center gap-0.5 text-label text-[8px]">V<input type="checkbox" class="comp-check" data-label="V"></label><label class="flex items-center gap-0.5 text-label text-[8px]">S<input type="checkbox" class="comp-check" data-label="S"></label><label class="flex items-center gap-0.5 text-label text-[8px]">M<input type="checkbox" class="comp-check" data-label="M"></label></div>
                                    </div>
                                    <div class="relative mt-2"><label class="text-label absolute top-[-8px] left-0 bg-white/60 px-1">DESCRIPCIÓN</label><div class="w-full lined-bg pt-2 desc-4-lines"><textarea class="w-full h-full bg-transparent resize-none border-none text-body p-0"></textarea></div></div>
                                </div>
                            </div>
                            `);
                        }
                    </script>
                </div>
                <!-- CONTENIDO MARCIAL P5 -->
                <div class="martial-content flex-grow flex flex-col gap-2 mb-6">
                    <h2 class="text-title text-center border-b-2 border-black mb-2">Talentos Superiores</h2>
                    <div class="flex-grow flex flex-col gap-1 h-full"> 
                         <script>
                            for(let i=0; i<6; i++) {
                                document.write(`
                                <div class="bg-white/60 p-1 border-b border-gray-400 flex-1 flex flex-col">
                                   <div class="flex justify-between items-end mb-1 flex-shrink-0">
                                       <div class="w-2/3"><span class="text-[10px] uppercase font-bold text-gray-500 block mb-0 leading-none">Nombre del Talento / Hazaña</span><input type="text" class="font-bold w-full text-body no-line border-b border-black p-0"></div>
                                       <div class="flex flex-col items-end"><span class="text-[10px] uppercase font-bold text-gray-600">Usos por día</span>
                                           <div class="flex gap-1">
                                               <div class="relative w-4 h-4"><input type="checkbox" class="icon-checkbox"><svg class="absolute inset-0 w-full h-full pointer-events-none" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2"><path d="M14.5 2.5l5 5-9 9H8v-2.5L14.5 2.5zM5 16l3 3M3 21l3-3" /></svg></div>
                                               <div class="relative w-4 h-4"><input type="checkbox" class="icon-checkbox"><svg class="absolute inset-0 w-full h-full pointer-events-none" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2"><path d="M14.5 2.5l5 5-9 9H8v-2.5L14.5 2.5zM5 16l3 3M3 21l3-3" /></svg></div>
                                               <div class="relative w-4 h-4"><input type="checkbox" class="icon-checkbox"><svg class="absolute inset-0 w-full h-full pointer-events-none" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2"><path d="M14.5 2.5l5 5-9 9H8v-2.5L14.5 2.5zM5 16l3 3M3 21l3-3" /></svg></div>
                                               <div class="relative w-4 h-4"><input type="checkbox" class="icon-checkbox"><svg class="absolute inset-0 w-full h-full pointer-events-none" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2"><path d="M14.5 2.5l5 5-9 9H8v-2.5L14.5 2.5zM5 16l3 3M3 21l3-3" /></svg></div>
                                               <div class="relative w-4 h-4"><input type="checkbox" class="icon-checkbox"><svg class="absolute inset-0 w-full h-full pointer-events-none" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2"><path d="M14.5 2.5l5 5-9 9H8v-2.5L14.5 2.5zM5 16l3 3M3 21l3-3" /></svg></div>
                                           </div>
                                       </div>
                                   </div>
                                   <div class="w-full flex-grow lined-bg relative"><textarea class="w-full h-full bg-transparent resize-none border-none text-body p-0 absolute inset-0 leading-[20px]"></textarea></div>
                                </div>
                                `);
                            }
                         </script>
                     </div>
                </div>

                <!-- CONTENIDO EXPERTOS -->
                <div class="expert-content flex-grow flex flex-col gap-2 mb-6">
                    <h2 class="text-title text-center border-b-2 border-black mb-2">Hazañas de Astucia</h2>
                    <div class="flex-grow flex flex-col gap-1 h-full"> 
                         <script>
                            for(let i=0; i<6; i++) {
                                document.write(`
                                <div class="bg-white/60 p-1 border-b border-gray-400 flex-1 flex flex-col">
                                   <div class="flex justify-between items-end mb-1 flex-shrink-0">
                                       <div class="w-2/3"><span class="text-[10px] uppercase font-bold text-gray-500 block mb-0 leading-none">Talento / Trampa / Habilidad</span><input type="text" class="font-bold w-full text-body no-line border-b border-black p-0"></div>
                                       <div class="flex flex-col items-end"><span class="text-[10px] uppercase font-bold text-gray-600">Usos / Cargas</span>
                                           <div class="flex gap-1">
                                               <div class="relative w-4 h-4"><input type="checkbox" class="icon-checkbox"><svg class="absolute inset-0 w-full h-full pointer-events-none" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z" /></svg></div>
                                               <div class="relative w-4 h-4"><input type="checkbox" class="icon-checkbox"><svg class="absolute inset-0 w-full h-full pointer-events-none" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z" /></svg></div>
                                               <div class="relative w-4 h-4"><input type="checkbox" class="icon-checkbox"><svg class="absolute inset-0 w-full h-full pointer-events-none" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z" /></svg></div>
                                           </div>
                                       </div>
                                   </div>
                                   <div class="w-full flex-grow lined-bg relative"><textarea class="w-full h-full bg-transparent resize-none border-none text-body p-0 absolute inset-0 leading-[20px]"></textarea></div>
                                </div>
                                `);
                            }
                         </script>
                     </div>
                </div>

                <!-- CONTENIDO SACROS -->
                <div class="sacred-content flex-grow flex flex-col gap-2 mb-6">
                    <h2 class="text-title text-center border-b-2 border-black mb-2">Rasgos Sagrados y Juramentos</h2>
                    <div class="flex-grow flex flex-col gap-1 h-full"> 
                         <script>
                            for(let i=0; i<6; i++) {
                                document.write(`
                                <div class="bg-white/60 p-1 border-b border-gray-400 flex-1 flex flex-col">
                                   <div class="flex justify-between items-end mb-1 flex-shrink-0">
                                       <div class="w-2/3"><span class="text-[10px] uppercase font-bold text-gray-500 block mb-0 leading-none">Rasgo de Dominio / Círculo / Juramento</span><input type="text" class="font-bold w-full text-body no-line border-b border-black p-0"></div>
                                       <div class="flex flex-col items-end"><span class="text-[10px] uppercase font-bold text-gray-600">Usos por descanso</span>
                                           <div class="flex gap-1">
                                               <div class="relative w-4 h-4"><input type="checkbox" class="icon-checkbox"><svg class="absolute inset-0 w-full h-full pointer-events-none" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2"><circle cx="12" cy="12" r="5" /><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" /></svg></div>
                                               <div class="relative w-4 h-4"><input type="checkbox" class="icon-checkbox"><svg class="absolute inset-0 w-full h-full pointer-events-none" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2"><circle cx="12" cy="12" r="5" /><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" /></svg></div>
                                               <div class="relative w-4 h-4"><input type="checkbox" class="icon-checkbox"><svg class="absolute inset-0 w-full h-full pointer-events-none" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2"><circle cx="12" cy="12" r="5" /><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" /></svg></div>
                                               <div class="relative w-4 h-4"><input type="checkbox" class="icon-checkbox"><svg class="absolute inset-0 w-full h-full pointer-events-none" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2"><circle cx="12" cy="12" r="5" /><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" /></svg></div>
                                               <div class="relative w-4 h-4"><input type="checkbox" class="icon-checkbox"><svg class="absolute inset-0 w-full h-full pointer-events-none" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2"><circle cx="12" cy="12" r="5" /><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" /></svg></div>
                                           </div>
                                       </div>
                                   </div>
                                   <div class="w-full flex-grow lined-bg relative"><textarea class="w-full h-full bg-transparent resize-none border-none text-body p-0 absolute inset-0 leading-[20px]"></textarea></div>
                                </div>
                                `);
                            }
                         </script>
                     </div>
                </div>

                <div class="page-num">7</div>
            </div>
        </div>
    </div>

    <!-- HOJA 6: P6 & P7 -->
    <div class="sheet-wrapper">
        <div class="sheet-controls no-print text-white mb-1"><span>Hoja Núcleo 6 (Combate Avanzado y Diario)</span><button onclick="downloadSheet('sheet6')" class="hover:text-blue-300 underline cursor-pointer text-xs ml-2">Descargar</button></div>
        <div id="sheet6" class="sheet-landscape">
            <div class="divider"></div>
            <!-- PÁGINA 6 -->
            <div class="page-a5">
                <div class="page-settings">
                     <div class="setting-btn" title="Color de Fondo">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 11l-8-8-8 9.9 8.1 8.1c1.3 1.3 3.3 1.3 4.6 0l2.7-2.7c1.3-1.3 1.3-3.3 0-4.6z"></path><path d="M22 22l-4-4"></path></svg>
                        <input type="color" onchange="this.closest('.page-a5').style.backgroundColor = this.value">
                     </div>
                     <div class="setting-btn" title="Trama/Patrón Individual">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="3" y1="15" x2="21" y2="15"></line><line x1="9" y1="3" x2="9" y2="21"></line><line x1="15" y1="3" x2="15" y2="21"></line></svg>
                        <input type="file" accept="image/*" onchange="applyLocalPattern(this)">
                     </div>
                </div>
                <!-- CONTENIDO MÁGICO P6 -->
                <div class="magic-content flex flex-col h-full gap-4">
                    <script>
                        for(let i=0; i<4; i++) {
                            document.write(`
                            <div class="spell-card flex-1 flex gap-2">
                                <div class="w-10 flex flex-col items-center justify-start pt-1"><label class="text-label mb-1 block">NIVEL</label><div class="spell-level-diamond"><input class="spell-level-input"></div></div>
                                <div class="flex-grow flex flex-col gap-1">
                                    <div class="flex items-end gap-1 mb-1"><label class="text-label">NOMBRE</label><input class="border-b border-black flex-grow h-6 text-title"></div>
                                    <div class="flex gap-1 mb-1 text-[10px]"> <!-- FIX APPLIED HERE -->
                                        <div class="flex items-end gap-0.5 flex-1"><label class="text-label text-[9px]">CAST:</label><input class="border-b border-gray-400 w-full h-4 text-body text-center min-w-0"></div>
                                        <div class="flex items-end gap-0.5 flex-1"><label class="text-label text-[9px]">DUR:</label><input class="border-b border-gray-400 w-full h-4 text-body text-center min-w-0"></div>
                                        <div class="flex items-end gap-0.5 flex-1"><label class="text-label text-[9px]">RNG:</label><input class="border-b border-gray-400 w-full h-4 text-body text-center min-w-0"></div>
                                        <div class="flex items-center gap-0.5 w-auto justify-end"><span class="text-label text-[9px] mr-0.5">COMPS:</span><label class="flex items-center gap-0.5 text-label text-[8px]">V<input type="checkbox" class="comp-check" data-label="V"></label><label class="flex items-center gap-0.5 text-label text-[8px]">S<input type="checkbox" class="comp-check" data-label="S"></label><label class="flex items-center gap-0.5 text-label text-[8px]">M<input type="checkbox" class="comp-check" data-label="M"></label></div>
                                    </div>
                                    <div class="relative mt-2"><label class="text-label absolute top-[-8px] left-0 bg-white/60 px-1">DESCRIPCIÓN</label><div class="w-full lined-bg pt-2 desc-4-lines"><textarea class="w-full h-full bg-transparent resize-none border-none text-body p-0"></textarea></div></div>
                                </div>
                            </div>
                            `);
                        }
                    </script>
                </div>
                <!-- CONTENIDO MARCIAL P6 -->
                <div class="martial-content h-full flex flex-col gap-4">
                     <div class="h-1/2 flex flex-col box-border p-2 bg-white/60">
                        <h2 class="text-title text-center border-b-2 border-black mb-2">Rastreador de Combate</h2>
                        <div class="grid grid-cols-[1.5rem_1fr_2rem_2rem_1fr] gap-1 text-center text-label font-bold border-b border-black pb-1 mb-1">
                            <div>INI</div><div class="text-left pl-1">NOMBRE</div><div>CA</div><div>PV</div><div>ESTADO</div>
                        </div>
                        <div class="flex-grow flex flex-col gap-1 overflow-hidden">
                            <script>
                                for(let i=0; i<12; i++){
                                    document.write(`
                                    <div class="grid grid-cols-[1.5rem_1fr_2rem_2rem_1fr] gap-1 h-5 items-center">
                                        <div class="border border-gray-400 rounded h-full"><input type="text" class="text-center w-full h-full p-0 no-line"></div>
                                        <div class="border-b border-gray-300 h-full"><input type="text" class="w-full h-full p-0 no-line text-body pl-1"></div>
                                        <div class="border border-gray-400 rounded h-full"><input type="text" class="text-center w-full h-full p-0 no-line"></div>
                                        <div class="border border-gray-400 rounded h-full"><input type="text" class="text-center w-full h-full p-0 no-line"></div>
                                        <div class="border-b border-gray-300 h-full"><input type="text" class="w-full h-full p-0 no-line text-xs"></div>
                                    </div>
                                    `);
                                }
                            </script>
                        </div>
                     </div>
                     <div class="h-1/2 flex flex-col box-border p-3 bg-white/60">
                        <h2 class="text-title text-center border-b-2 border-black mb-2">Notas de Batalla</h2>
                        <div class="h-full w-full lined-bg"></div>
                     </div>
                </div>

                <!-- CONTENIDO EXPERTOS -->
                <div class="expert-content h-full flex flex-col gap-4">
                     <div class="h-1/2 flex flex-col box-border p-2 bg-white/60">
                        <h2 class="text-title text-center border-b-2 border-black mb-2">Rastreador de Sigilo y Combate</h2>
                        <div class="grid grid-cols-[1.5rem_1fr_2rem_2rem_1.5rem_1fr] gap-1 text-center text-label font-bold border-b border-black pb-1 mb-1">
                            <div>INI</div><div class="text-left pl-1">NOMBRE</div><div>CA</div><div>PV</div>
                            <div class="flex items-center justify-center"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg></div>
                            <div>ESTADO</div>
                        </div>
                        <div class="flex-grow flex flex-col gap-1 overflow-hidden">
                            <script>
                                for(let i=0; i<12; i++){
                                    document.write(`
                                    <div class="grid grid-cols-[1.5rem_1fr_2rem_2rem_1.5rem_1fr] gap-1 h-5 items-center">
                                        <div class="border border-gray-400 rounded h-full"><input type="text" class="text-center w-full h-full p-0 no-line"></div>
                                        <div class="border-b border-gray-300 h-full"><input type="text" class="w-full h-full p-0 no-line text-body pl-1"></div>
                                        <div class="border border-gray-400 rounded h-full"><input type="text" class="text-center w-full h-full p-0 no-line"></div>
                                        <div class="border border-gray-400 rounded h-full"><input type="text" class="text-center w-full h-full p-0 no-line"></div>
                                        <div class="h-full flex items-center justify-center border-b border-gray-300"><input type="checkbox" class="w-3 h-3 border border-black cursor-pointer"></div>
                                        <div class="border-b border-gray-300 h-full"><input type="text" class="w-full h-full p-0 no-line text-xs"></div>
                                    </div>
                                    `);
                                }
                            </script>
                        </div>
                     </div>
                     <div class="h-1/2 flex flex-col box-border p-3 bg-white/60"><h2 class="text-title text-center border-b-2 border-black mb-2">Notas de Misión y Sigilo</h2><div class="h-full w-full lined-bg"></div></div>
                </div>

                <!-- CONTENIDO SACROS -->
                <div class="sacred-content h-full flex flex-col gap-4">
                     <div class="h-1/2 flex flex-col box-border p-2 bg-white/60">
                        <h2 class="text-title text-center border-b-2 border-black mb-2">Rastreador de Auras y Bendiciones</h2>
                        <div class="grid grid-cols-[1.5rem_1fr_2rem_2rem_1.5rem_1fr] gap-1 text-center text-label font-bold border-b border-black pb-1 mb-1">
                            <div>INI</div><div class="text-left pl-1">NOMBRE</div><div>CA</div><div>PV</div>
                            <div class="flex items-center justify-center"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg></div>
                            <div>ESTADO</div>
                        </div>
                        <div class="flex-grow flex flex-col gap-1 overflow-hidden">
                            <script>
                                for(let i=0; i<12; i++){
                                    document.write(`
                                    <div class="grid grid-cols-[1.5rem_1fr_2rem_2rem_1.5rem_1fr] gap-1 h-5 items-center">
                                        <div class="border border-gray-400 rounded h-full"><input type="text" class="text-center w-full h-full p-0 no-line"></div>
                                        <div class="border-b border-gray-300 h-full"><input type="text" class="w-full h-full p-0 no-line text-body pl-1"></div>
                                        <div class="border border-gray-400 rounded h-full"><input type="text" class="text-center w-full h-full p-0 no-line"></div>
                                        <div class="border border-gray-400 rounded h-full"><input type="text" class="text-center w-full h-full p-0 no-line"></div>
                                        <div class="h-full flex items-center justify-center border-b border-gray-300"><input type="checkbox" class="w-3 h-3 border border-black cursor-pointer"></div>
                                        <div class="border-b border-gray-300 h-full"><input type="text" class="w-full h-full p-0 no-line text-xs"></div>
                                    </div>
                                    `);
                                }
                            </script>
                        </div>
                     </div>
                     <div class="h-1/2 flex flex-col box-border p-3 bg-white/60"><h2 class="text-title text-center border-b-2 border-black mb-2">Plegarias y Efectos Activos</h2><div class="h-full w-full lined-bg"></div></div>
                </div>

                <div class="page-num">8</div>
            </div>
            <!-- PÁGINA 7 (NPCs) -->
            <div class="page-a5">
                <div class="page-settings">
                     <div class="setting-btn" title="Color de Fondo">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 11l-8-8-8 9.9 8.1 8.1c1.3 1.3 3.3 1.3 4.6 0l2.7-2.7c1.3-1.3 1.3-3.3 0-4.6z"></path><path d="M22 22l-4-4"></path></svg>
                        <input type="color" onchange="this.closest('.page-a5').style.backgroundColor = this.value">
                     </div>
                     <div class="setting-btn" title="Trama/Patrón Individual">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="3" y1="15" x2="21" y2="15"></line><line x1="9" y1="3" x2="9" y2="21"></line><line x1="15" y1="3" x2="15" y2="21"></line></svg>
                        <input type="file" accept="image/*" onchange="applyLocalPattern(this)">
                     </div>
                </div>
                 <h2 class="text-title text-center border-b-2 border-black mb-4">Registro de NPCs y Contactos</h2>
                 <div class="grid grid-cols-2 gap-3 h-full">
                     <script>
                        for(let i=0; i<8; i++){
                            document.write(`
                            <div class="box-border p-2 bg-white/60 flex flex-col gap-1 shadow-sm border border-gray-400">
                                <div class="flex justify-between items-end border-b border-black pb-1">
                                    <div class="w-2/3"><span class="text-[10px] uppercase font-bold text-gray-500 block leading-none mb-0.5">Nombre del NPC / Rol</span><input type="text" class="font-bold text-body w-full no-line p-0 bg-transparent"></div>
                                    <div class="flex items-center gap-1 border-l border-gray-300 pl-2 ml-1 pb-0.5">
                                        <span class="text-[10px] uppercase font-bold text-gray-500">Misión</span>
                                        <div class="relative w-4 h-4 cursor-pointer">
                                            <input type="checkbox" class="icon-checkbox">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2" class="absolute inset-0 w-full h-full pointer-events-none">
                                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                                <circle cx="12" cy="7" r="4"></circle>
                                            </svg>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex-grow relative min-h-[30px]"><span class="text-[10px] uppercase font-bold text-gray-400 absolute top-0 left-0 bg-white/80 pr-1">Historia / Notas</span><textarea class="w-full h-full resize-none border-none bg-transparent text-body lined-bg p-0 leading-snug pt-3"></textarea></div>
                            </div>
                            `);
                        }
                     </script>
                 </div>
                 <div class="page-num">9</div>
            </div>
        </div>
    </div>

    <script>
        function applyGlobalColor(color) {
            // Apply to all pages
            const pages = document.querySelectorAll('.page-a5');
            pages.forEach(page => {
                page.style.backgroundColor = color;
                
                // Also update the individual picker value inside the page to match global
                const localPicker = page.querySelector('.page-settings input[type="color"]');
                if(localPicker) localPicker.value = color;
            });
        }

        function applyBackground(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const pages = document.querySelectorAll('.page-a5');
                    pages.forEach(page => {
                        page.style.backgroundImage = `url('${e.target.result}')`;
                        page.style.backgroundSize = "cover";
                    });
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        function applyPattern(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const pages = document.querySelectorAll('.page-a5');
                    pages.forEach(page => {
                        let patternLayer = page.querySelector('.pattern-layer');
                        if (!patternLayer) {
                            patternLayer = document.createElement('div');
                            patternLayer.className = 'pattern-layer';
                            page.insertBefore(patternLayer, page.firstChild);
                        }
                        patternLayer.style.backgroundImage = `url('${e.target.result}')`;
                    });
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        // --- NEW FUNCTION FOR INDIVIDUAL PAGE PATTERN ---
        function applyLocalPattern(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const page = input.closest('.page-a5');
                    let patternLayer = page.querySelector('.pattern-layer');
                    if (!patternLayer) {
                        patternLayer = document.createElement('div');
                        patternLayer.className = 'pattern-layer';
                        // Ensure it is inserted at the beginning so it is behind content but above bg color
                        page.insertBefore(patternLayer, page.firstChild);
                    }
                    patternLayer.style.backgroundImage = `url('${e.target.result}')`;
                }
                reader.readAsDataURL(input.files[0]);
            }
        }
        
        function loadCoverArt(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.getElementById('coverArtImg');
                    const placeholder = document.querySelector('.art-placeholder-text');
                    img.src = e.target.result;
                    img.style.display = 'block';
                    if(placeholder) placeholder.style.display = 'none';
                }
                reader.readAsDataURL(input.files[0]);
            }
        }
        
        function previewSymbol(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    // Update P3 Image
                    const img = document.getElementById('p1SymbolImg');
                    if(img) {
                        img.src = e.target.result;
                        img.classList.remove('hidden');
                        if(input.parentElement) {
                            const span = input.parentElement.querySelector('span');
                            if(span) span.style.display = 'none';
                            input.parentElement.classList.remove('border-dashed', 'border-2', 'border-gray-400');
                        }
                    }

                    // Update P15 Image (Level History)
                    const histImg = document.getElementById('levelHistorySymbolImg');
                    if(histImg) {
                        histImg.src = e.target.result;
                        histImg.classList.remove('hidden');
                    }
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        function changeClassMode(mode) {
            document.body.classList.remove('mode-martial', 'mode-magic', 'mode-expert', 'mode-sacred');
            document.body.classList.add(`mode-${mode}`);
        }

        function changeTheme(theme) {
            document.body.classList.remove('theme-gothic', 'theme-doodle');
            if (theme !== 'classic') {
                document.body.classList.add(`theme-${theme}`);
            }
        }

        function downloadSheet(id) {
            const element = document.getElementById(id);
            html2canvas(element, { scale: 3, useCORS: true, backgroundColor: null, onclone: (clonedDoc) => {
                const inputs = clonedDoc.querySelectorAll('input[type="text"]');
                inputs.forEach(input => { input.style.marginTop = '-3px'; });
                const textareas = clonedDoc.querySelectorAll('textarea');
                textareas.forEach(t => { t.style.marginTop = '-2px'; });
            }}).then(canvas => {
                const link = document.createElement('a');
                link.download = `Hoja_DND_${id}.jpg`; 
                link.href = canvas.toDataURL('image/jpeg', 0.9);
                link.click();
            });
        }

        async function downloadAllSheets() {
            const sheets = document.querySelectorAll('.sheet-landscape');
            for (let i = 0; i < sheets.length; i++) {
                const sheet = sheets[i];
                // Background color null makes sure it captures the dynamic background set via style
                const canvas = await html2canvas(sheet, { scale: 3, backgroundColor: null, onclone: (clonedDoc) => {
                    const inputs = clonedDoc.querySelectorAll('input[type="text"]');
                    inputs.forEach(input => input.style.marginTop = '-3px');
                    const textareas = clonedDoc.querySelectorAll('textarea');
                    textareas.forEach(t => t.style.marginTop = '-2px');
                }});
                const link = document.createElement('a');
                link.download = `Hoja_DND_Pagina_${i + 1}.jpg`;
                link.href = canvas.toDataURL('image/jpeg', 0.9);
                link.click();
                await new Promise(r => setTimeout(r, 500));
            }
        }
    </script>
</body>
</html>
